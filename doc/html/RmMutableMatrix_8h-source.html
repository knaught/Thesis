<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Robot Mapper: include/RmMutableMatrix.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000001.html">include</a></div>
<h1>RmMutableMatrix.h</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">// RmMutableMatrix.h</span>
00002 
00003 <span class="preprocessor">#ifndef RM_MUTABLE_MATRIX_H</span>
00004 <span class="preprocessor"></span><span class="preprocessor">#define RM_MUTABLE_MATRIX_H</span>
00005 <span class="preprocessor"></span>
00006 <span class="preprocessor">#include &lt;vector&gt;</span>
00007 <span class="preprocessor">#include &lt;iostream&gt;</span>
00008 <span class="preprocessor">#include &lt;cmath&gt;</span>
00009 <span class="preprocessor">#include &lt;cassert&gt;</span>
00010 <span class="preprocessor">#include "RmExceptions.h"</span>
00011 <span class="preprocessor">#include "RmUtility.h"</span>
00012 
00013 
00057 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00058"></a><a class="code" href="classRmMutableMatrix.html">00058</a> <span class="keyword">class </span><a class="code" href="classRmMutableMatrix.html">RmMutableMatrix</a>
00059 {
00060 <span class="keyword">public</span>:
00061 
00066         <span class="comment">// This is public so that a using class may itself provide this [][] functionality without</span>
00067         <span class="comment">// implementing it directly; see RmBayesCertaintyGrid for an example.</span>
00068         <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; 
<a name="l00069"></a><a class="code" href="classRmMutableMatrix_1_1Operator2D.html">00069</a>         <span class="keyword">class </span><a class="code" href="classRmMutableMatrix_1_1Operator2D.html">Operator2D</a>
00070         {
00071         <span class="keyword">public</span>:
00072 
<a name="l00079"></a><a class="code" href="classRmMutableMatrix_1_1Operator2D.html#a1">00079</a>                 <a class="code" href="classRmMutableMatrix_1_1Operator2D.html">Operator2D</a>( <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix&lt;T&gt;</a>* v, <span class="keywordtype">int</span> x ) : m_m2v(v), m_m2vc(NULL), m_x(x) {}
00080 
00081 
<a name="l00085"></a><a class="code" href="classRmMutableMatrix_1_1Operator2D.html#a0">00085</a>                 <a class="code" href="classRmMutableMatrix_1_1Operator2D.html">Operator2D</a>( <span class="keyword">const</span> <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix&lt;T&gt;</a>* v, <span class="keywordtype">int</span> x ) : m_m2v(NULL), m_m2vc(v), m_x(x) {}
00086 
00087 
<a name="l00094"></a><a class="code" href="classRmMutableMatrix_1_1Operator2D.html#a3">00094</a>                 T&amp; operator[]( <span class="keywordtype">int</span> y ) { 
00095                         <span class="keywordflow">return</span> m_m2v-&gt;valueAt( m_x, y ); }
00096 
00097 
<a name="l00101"></a><a class="code" href="classRmMutableMatrix_1_1Operator2D.html#a2">00101</a>                 <span class="keyword">const</span> T&amp; operator[]( <span class="keywordtype">int</span> y )<span class="keyword"> const </span>{ 
00102                         <span class="keywordflow">return</span> m_m2vc-&gt;valueAt( m_x, y ); }
00103 
00104         <span class="keyword">private</span>:
00105 
00106                 <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix&lt;T&gt;</a>* m_m2v;
00107                 <span class="keyword">const</span> <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix&lt;T&gt;</a>* m_m2vc;
00108                 <span class="keyword">const</span> <span class="keywordtype">int</span> m_x;
00109         };
00110 
00111 
00122         <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix</a>( <span class="keywordtype">int</span> w = 10, <span class="keywordtype">int</span> h = 10, <span class="keyword">const</span> T initVal = T(), <span class="keyword">const</span> <span class="keywordtype">char</span>* colSep = <span class="stringliteral">" "</span>,
00123                 <span class="keyword">const</span> <span class="keywordtype">char</span>* rowSep = <span class="stringliteral">"\n"</span>, <span class="keywordtype">bool</span> autoResize = <span class="keyword">true</span> );
00124 
00125 
00129         <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix</a>&amp; operator= ( <span class="keyword">const</span> <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix</a>&amp; source );
00130 
00131 
<a name="l00136"></a><a class="code" href="classRmMutableMatrix.html#a12">00136</a>         <span class="keywordtype">void</span> setInitValue( <span class="keyword">const</span> T initVal ) { m_initVal = initVal; }
00137 
00138 
<a name="l00142"></a><a class="code" href="classRmMutableMatrix.html#a3">00142</a>         T initValue( )<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_initVal; }
00143         
00144 
00161         <span class="keyword">virtual</span> <span class="keywordtype">void</span> resizeBy( <span class="keywordtype">int</span> north, <span class="keywordtype">int</span> south, <span class="keywordtype">int</span> east, <span class="keywordtype">int</span> west );
00162 
00163 
00174         <span class="keyword">virtual</span> <span class="keywordtype">void</span> rotateBy( <span class="keyword">const</span> <span class="keywordtype">double</span> theta );
00175 
00176 
00182         <span class="keyword">virtual</span> <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix&lt;T&gt;</a> rotatedBy( <span class="keyword">const</span> <span class="keywordtype">double</span> theta ) <span class="keyword">const</span>;
00183 
00184 
00188         <span class="keyword">virtual</span> <span class="keywordtype">void</span> clear();
00189 
00190 
00194         <span class="keyword">virtual</span> <span class="keywordtype">void</span> empty();
00195 
00196 
<a name="l00200"></a><a class="code" href="classRmMutableMatrix.html#a2">00200</a>         <span class="keywordtype">int</span> height()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_height; }
00201 
00202 
<a name="l00206"></a><a class="code" href="classRmMutableMatrix.html#a15">00206</a>         <span class="keywordtype">int</span> width()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_width; }
00207 
00208 
00230         <span class="keyword">virtual</span> T&amp; valueAt( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y );
00231 
00232         
00238         <span class="keyword">virtual</span> <span class="keyword">const</span> T&amp; valueAt( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y ) <span class="keyword">const</span>;
00239 
00240 
<a name="l00247"></a><a class="code" href="classRmMutableMatrix.html#a6">00247</a>         Operator2D&lt;T&gt; operator[]( <span class="keywordtype">int</span> x ) { 
00248                 <span class="keywordflow">return</span> Operator2D&lt;T&gt;( <span class="keyword">this</span>, x ); }
00249 
00250         
<a name="l00254"></a><a class="code" href="classRmMutableMatrix.html#a5">00254</a>         <span class="keyword">const</span> Operator2D&lt;T&gt; operator[]( <span class="keywordtype">int</span> x )<span class="keyword"> const </span>{ 
00255                 <span class="keywordflow">return</span> Operator2D&lt;T&gt;( <span class="keyword">this</span>, x ); }
00256 
00257 
00266         <span class="keyword">virtual</span> std::ostream&amp; put( std::ostream&amp; os, <span class="keyword">const</span> <span class="keywordtype">char</span> *format = NULL ) <span class="keyword">const</span>;
00267 
00268 <span class="keyword">private</span>:
00269 
00270         <span class="keywordtype">int</span> m_initWidth, m_width;
00271         <span class="keywordtype">int</span> m_initHeight, m_height;
00272         T m_initVal;
00273         <span class="keyword">const</span> <span class="keywordtype">char</span>* m_colSep;
00274         <span class="keyword">const</span> <span class="keywordtype">char</span>* m_rowSep;
00275 
00276         std::vector&lt; std::vector&lt;T&gt; &gt; m_2dVector;
00277 
00278         <span class="keywordtype">bool</span> m_isAutoResizable;
00279 
00280 };
00281 
00282 
00283 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00284"></a><a class="code" href="classRmMutableMatrix.html#a9">00284</a> <a class="code" href="classRmMutableMatrix.html#a9">RmMutableMatrix&lt;T&gt;::RmMutableMatrix</a>( <span class="keywordtype">int</span> w , <span class="keywordtype">int</span> h, <span class="keyword">const</span> T initVal, <span class="keyword">const</span> <span class="keywordtype">char</span>* colSep, 
00285         <span class="keyword">const</span> <span class="keywordtype">char</span>* rowSep, <span class="keywordtype">bool</span> autoResize )
00286         : m_initWidth(w), m_width(w), m_initHeight(h), m_height(h),
00287           m_2dVector(h, std::vector&lt;T&gt;( w, initVal )), m_initVal(initVal),
00288           m_colSep(colSep), m_rowSep(rowSep), m_isAutoResizable(autoResize)
00289 {
00290 }
00291 
00292 
00293 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00294"></a><a class="code" href="classRmMutableMatrix.html#a4">00294</a> <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix&lt;T&gt;</a>&amp; <a class="code" href="classRmMutableMatrix.html#a4">RmMutableMatrix&lt;T&gt;::operator=</a>( <span class="keyword">const</span> <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix</a>&amp; source )
00295 {
00296         m_initWidth = source.<a class="code" href="classRmMutableMatrix.html#r5">m_initWidth</a>;
00297         m_initHeight = source.<a class="code" href="classRmMutableMatrix.html#r3">m_initHeight</a>;
00298         m_initVal = source.<a class="code" href="classRmMutableMatrix.html#r4">m_initVal</a>;
00299         m_width = source.<a class="code" href="classRmMutableMatrix.html#r8">m_width</a>;
00300         m_height = source.<a class="code" href="classRmMutableMatrix.html#r2">m_height</a>;
00301         m_2dVector = source.<a class="code" href="classRmMutableMatrix.html#r0">m_2dVector</a>;
00302         m_isAutoResizable = source.<a class="code" href="classRmMutableMatrix.html#r6">m_isAutoResizable</a>;
00303         m_colSep = source.<a class="code" href="classRmMutableMatrix.html#r1">m_colSep</a>;
00304         m_rowSep = source.<a class="code" href="classRmMutableMatrix.html#r7">m_rowSep</a>;
00305 
00306         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00307 }
00308 
00309 
00310 
00311 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00312"></a><a class="code" href="classRmMutableMatrix.html#a8">00312</a> <span class="keywordtype">void</span> <a class="code" href="classRmMutableMatrix.html#a8">RmMutableMatrix&lt;T&gt;::resizeBy</a>( <span class="keywordtype">int</span> north, <span class="keywordtype">int</span> south, <span class="keywordtype">int</span> east, <span class="keywordtype">int</span> west )
00313 {
00314         <span class="comment">// A negative value removes that number of rows/colums from the corresponding border</span>
00315         <span class="comment">// A positive value adds that number of rows/colums to the corresponding border</span>
00316 
00317         <span class="keywordflow">if</span> ( m_height + north + south &lt; 0 || m_width + east + west &lt; 0 ) {
00318                 <span class="keywordtype">char</span> buff[100];
00319                 sprintf( buff, <span class="stringliteral">"height = %d, width = %d, north = %d, south = %d, east = %d, west = %d"</span>,
00320                         m_height, m_width, north, south, east, west );
00321                 assert( <span class="keyword">false</span> );
00322                 <span class="keywordflow">throw</span> <a class="code" href="structRmExceptions_1_1InvalidDimensionException.html">RmExceptions::InvalidDimensionException</a>( <span class="stringliteral">"RmMutableMatrix&lt;T&gt;::resizeBy()"</span>, buff );
00323         }
00324 
00325         <span class="comment">// North</span>
00326         <span class="keywordflow">if</span> ( north &lt; 0 ) {
00327                 m_2dVector.erase( m_2dVector.begin(), m_2dVector.begin() + -north );
00328                 m_height += north;
00329         }
00330         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( north &gt; 0 ) {
00331                 m_2dVector.insert( m_2dVector.begin(), north, std::vector&lt;T&gt;( m_width, m_initVal ) );
00332                 m_height += north;
00333         }
00334 
00335         <span class="comment">// South</span>
00336         <span class="keywordflow">if</span> ( south &lt; 0 ) {
00337                 m_2dVector.erase( m_2dVector.end() + south, m_2dVector.end() );
00338                 m_height += south;
00339         }
00340         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( south &gt; 0 ) {
00341                 m_2dVector.insert( m_2dVector.end(), south, std::vector&lt;T&gt;( m_width, m_initVal ) );
00342                 m_height += south;
00343         }
00344 
00345         <span class="comment">// East</span>
00346         <span class="keywordflow">if</span> ( east &lt; 0 ) 
00347         {
00348                 <span class="keywordflow">for</span> ( std::vector&lt; std::vector&lt;T&gt; &gt;::iterator rows = m_2dVector.begin(); 
00349                         rows != m_2dVector.end(); ++rows )
00350                 {
00351                         std::vector&lt;T&gt;&amp; row = *rows;
00352                         row.erase( row.end() + east, row.end() );
00353                 }
00354                 m_width += east;
00355         }
00356         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( east &gt; 0 ) {
00357                 <span class="keywordflow">for</span> ( std::vector&lt; std::vector&lt;T&gt; &gt;::iterator rows = m_2dVector.begin(); 
00358                         rows != m_2dVector.end(); ++rows )
00359                 {
00360                         std::vector&lt;T&gt;&amp; row = *rows;
00361                         row.insert( row.end(), east, m_initVal );
00362                 }
00363                 m_width += east;
00364         }
00365 
00366         <span class="comment">// West</span>
00367         <span class="keywordflow">if</span> ( west &lt; 0 ) 
00368         {
00369                 <span class="keywordflow">for</span> ( std::vector&lt; std::vector&lt;T&gt; &gt;::iterator rows = m_2dVector.begin(); 
00370                         rows != m_2dVector.end(); ++rows )
00371                 {
00372                         std::vector&lt;T&gt;&amp; row = *rows;
00373                         row.erase( row.begin(), row.begin() + -west );
00374                 }
00375                 m_width += west;
00376         }
00377         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( west &gt; 0 ) {
00378                 <span class="keywordflow">for</span> ( std::vector&lt; std::vector&lt;T&gt; &gt;::iterator rows = m_2dVector.begin(); 
00379                         rows != m_2dVector.end(); ++rows )
00380                 {
00381                         std::vector&lt;T&gt;&amp; row = *rows;
00382                         row.insert( row.begin(), west, m_initVal );
00383                 }
00384                 m_width += west;
00385         }
00386 }
00387 
00388 
00389 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00390"></a><a class="code" href="classRmMutableMatrix.html#a0">00390</a> <span class="keywordtype">void</span> <a class="code" href="classRmMutableMatrix.html#a0">RmMutableMatrix&lt;T&gt;::clear</a>()
00391 {
00392         <span class="keywordflow">for</span> ( std::vector&lt; std::vector&lt;T&gt; &gt;::iterator rows = m_2dVector.begin(); 
00393                 rows != m_2dVector.end(); ++rows )
00394         {
00395                 <span class="keywordflow">for</span> ( std::vector&lt;T&gt;::iterator cols = (*rows).begin(); cols != (*rows).end(); ++cols )
00396                 {
00397                         *cols = m_initVal;
00398                 }
00399         }
00400 }
00401 
00402 
00403 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00404"></a><a class="code" href="classRmMutableMatrix.html#a1">00404</a> <span class="keywordtype">void</span> <a class="code" href="classRmMutableMatrix.html#a1">RmMutableMatrix&lt;T&gt;::empty</a>()
00405 {
00406         <a class="code" href="classRmMutableMatrix.html#a8">RmMutableMatrix&lt;T&gt;::resizeBy</a>( -(m_height - m_initHeight), 0, -(m_width - m_initWidth), 0 );
00407         <a class="code" href="classRmMutableMatrix.html#a0">RmMutableMatrix&lt;T&gt;::clear</a>();
00408 }
00409 
00410 
00411 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00412"></a><a class="code" href="classRmMutableMatrix.html#a14">00412</a> T&amp; <a class="code" href="classRmMutableMatrix.html#a14">RmMutableMatrix&lt;T&gt;::valueAt</a>( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
00413 {
00414         <span class="comment">// This method is cannot be a const because out-of-bounds indexes cause</span>
00415         <span class="comment">// the matrix to be resized.</span>
00416 
00417         <span class="keywordflow">if</span> ( m_isAutoResizable ) 
00418         {
00419                 <span class="comment">// Grow height southward (positive) or northward (negative)</span>
00420                 <span class="keywordtype">int</span> yDelta = y &lt; 0 ? -y : y &gt;= m_height ? y - m_height + 1: 0;
00421                 <span class="keywordflow">if</span> ( yDelta != 0 ) {
00422                         <span class="keywordflow">if</span> ( y &gt;= 0 ) <a class="code" href="classRmMutableMatrix.html#a8">RmMutableMatrix&lt;T&gt;::resizeBy</a>( 0, yDelta, 0, 0 );
00423                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( y &lt; 0 ) RmMutableMatrix&lt;T&gt;::resizeBy( yDelta, 0, 0, 0 );
00424                 }
00425 
00426                 <span class="comment">// Grow width eastward (positive) or westward (negative)</span>
00427                 <span class="keywordtype">int</span> xDelta = x &lt; 0 ? -x : x &gt;= m_width ? x - m_width + 1: 0;
00428                 <span class="keywordflow">if</span> ( xDelta != 0 ) {
00429                         <span class="keywordflow">if</span> ( x &gt;= 0 ) <a class="code" href="classRmMutableMatrix.html#a8">RmMutableMatrix&lt;T&gt;::resizeBy</a>( 0, 0, xDelta, 0 );
00430                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( x &lt; 0 ) RmMutableMatrix&lt;T&gt;::resizeBy( 0, 0, 0, xDelta );
00431                 }
00432         }
00433         <span class="keywordflow">else</span>
00434         {
00435                 <span class="keywordflow">if</span> ( !(x &gt;= 0 &amp;&amp; x &lt; m_width &amp;&amp; y &gt;= 0 &amp;&amp; y &lt; m_height) ) {
00436                         <span class="keywordtype">char</span> buff[50];
00437                         sprintf( buff, <span class="stringliteral">"Index constraint: [0..%d)[0..%d); Requested index: [%d][%d]"</span>, 
00438                                 m_width, m_height, x, y );
00439                         <span class="keywordflow">throw</span> <a class="code" href="structRmExceptions_1_1IndexOutOfBoundsException.html">RmExceptions::IndexOutOfBoundsException</a>( <span class="stringliteral">"RmMutableMatrix&lt;T&gt;::valueAt()"</span>, buff );
00440                 }
00441         }
00442 
00443         <span class="keywordflow">return</span> m_2dVector[y &lt; 0 ? 0 : y][x &lt; 0 ? 0 : x];
00444 }
00445 
00446 
00447 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00448"></a><a class="code" href="classRmMutableMatrix.html#a13">00448</a> <span class="keyword">const</span> T&amp; <a class="code" href="classRmMutableMatrix.html#a14">RmMutableMatrix&lt;T&gt;::valueAt</a>( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )<span class="keyword"> const</span>
00449 <span class="keyword"></span>{
00450         <span class="keywordflow">if</span> ( !(x &gt;= 0 &amp;&amp; x &lt; m_width &amp;&amp; y &gt;= 0 &amp;&amp; y &lt; m_height) ) {
00451                 <span class="keywordtype">char</span> buff[50];
00452                 sprintf( buff, <span class="stringliteral">"Index constraint: [0..%d)[0..%d); Requested index: [%d][%d]"</span>, 
00453                         m_width, m_height, x, y );
00454                 <span class="keywordflow">throw</span> <a class="code" href="structRmExceptions_1_1IndexOutOfBoundsException.html">RmExceptions::IndexOutOfBoundsException</a>( <span class="stringliteral">"RmMutableMatrix&lt;T&gt;::valueAt()"</span>, buff );
00455         }
00456 
00457         <span class="keywordflow">return</span> m_2dVector[y][x];
00458 }
00459 
00460 
00461 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00462"></a><a class="code" href="classRmMutableMatrix.html#a11">00462</a> <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix&lt;T&gt;</a> <a class="code" href="classRmMutableMatrix.html#a11">RmMutableMatrix&lt;T&gt;::rotatedBy</a>( <span class="keyword">const</span> <span class="keywordtype">double</span> theta )<span class="keyword"> const</span>
00463 <span class="keyword"></span>{
00464         <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix&lt;T&gt;</a> mm( *<span class="keyword">this</span> );
00465         mm.<a class="code" href="classRmMutableMatrix.html#a10">rotateBy</a>( theta );
00466         <span class="keywordflow">return</span> mm;
00467 }
00468 
00469 
00470 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00471"></a><a class="code" href="classRmMutableMatrix.html#a10">00471</a> <span class="keywordtype">void</span> <a class="code" href="classRmMutableMatrix.html#a10">RmMutableMatrix&lt;T&gt;::rotateBy</a>( <span class="keyword">const</span> <span class="keywordtype">double</span> theta )
00472 {
00473         <span class="comment">// Adapted from:  </span>
00474         <span class="comment">// Robert D. Grappel, "Rotating a Weather Map"</span>
00475         <span class="comment">// Dr. Dobb's Journal, June 1999</span>
00476         <span class="comment">// http://www.ddj.com/documents/s=902/ddj9906h/9906h.htm (by subscription)</span>
00477         <span class="comment">// Requirements:  input/output matrices MUST BE SQUARE</span>
00478         <span class="comment">//</span>
00479         <span class="comment">// Adaptations:</span>
00480         <span class="comment">// - vectors, derived parameters, point-of-use initialization</span>
00481         <span class="comment">// - removal of negation on radian calculation</span>
00482         <span class="comment">// - boundaries on loops from [1..nij] to [0..nij)</span>
00483         <span class="comment">// - auto-sizing of matrix into square accommodating distance between opposite corners</span>
00484         <span class="comment">// - correction for 1-pixel drift</span>
00485 
00486         <span class="comment">// Create squared copy of this matrix as input matrix</span>
00487         <span class="keyword">const</span> <span class="keywordtype">int</span> w = m_width;
00488         <span class="keyword">const</span> <span class="keywordtype">int</span> h = m_height;
00489         <span class="keyword">const</span> <span class="keywordtype">int</span> d = static_cast&lt;int&gt;(sqrt( static_cast&lt;double&gt;(w * w + h * h) ) + 0.5);
00490         <span class="keyword">const</span> <span class="keywordtype">double</span> wDelta = (d - w) / 2.0;
00491         <span class="keyword">const</span> <span class="keywordtype">double</span> hDelta = (d - h) / 2.0;
00492         <a class="code" href="classRmMutableMatrix.html">RmMutableMatrix&lt;T&gt;</a> inmap( *<span class="keyword">this</span> );
00493         inmap.<a class="code" href="classRmMutableMatrix.html#a8">resizeBy</a>( hDelta, hDelta, wDelta, wDelta );
00494 
00495         <span class="comment">// Square and clear this matrix as the output matrix</span>
00496         <span class="keyword">const</span> <span class="keywordtype">int</span> nij = inmap.<a class="code" href="classRmMutableMatrix.html#r8">m_width</a>;
00497         <a class="code" href="classRmMutableMatrix.html#a0">RmMutableMatrix&lt;T&gt;::clear</a>();
00498         <a class="code" href="classRmMutableMatrix.html#a8">RmMutableMatrix&lt;T&gt;::resizeBy</a>( hDelta, hDelta, wDelta, wDelta );
00499 
00500         <span class="comment">// Precalc optimizations</span>
00501         <span class="keyword">const</span> <span class="keywordtype">int</span> nijh = (nij / 2) + 1;            <span class="comment">/* midpoint of the map */</span>
00502         <span class="keywordtype">double</span> rad = theta * RmUtility::Pi / 180.0;          <span class="comment">/* convert angle to radians */</span>
00503         <span class="keyword">const</span> <span class="keywordtype">double</span> s = sin( rad );
00504         <span class="keyword">const</span> <span class="keywordtype">double</span> c = cos( rad );
00505         <span class="keyword">const</span> <span class="keywordtype">double</span> n0 = 0.5 - nijh;
00506 
00507         <span class="comment">/* precompute sine and cosine tables */</span>
00508         std::vector&lt;double&gt; s0( nij );
00509         std::vector&lt;double&gt; c0( nij );
00510         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; nij; i++ ) 
00511         { 
00512                 <span class="keyword">const</span> <span class="keywordtype">double</span> x0 = static_cast&lt;double&gt;(i) + n0;
00513                 c0[i] = x0 * c;  
00514                 s0[i] = x0 * s;
00515         }
00516 
00517         <span class="keywordflow">for</span> ( i = 0; i &lt; nij; i++ )
00518         {
00519                 <span class="keyword">const</span> <span class="keywordtype">double</span> cc0 = nijh + c0[i];  
00520                 <span class="keyword">const</span> <span class="keywordtype">double</span> ss0 = nijh - s0[i];
00521                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j &lt; nij; j++ )
00522                 {
00523                         <span class="keyword">const</span> <span class="keywordtype">double</span> x = cc0 + s0[j];
00524                         <span class="keywordflow">if</span> ((x &lt; 0) || (x &gt; nij)) <span class="keywordflow">continue</span>;
00525                         <span class="keyword">const</span> <span class="keywordtype">double</span> y = ss0 + c0[j];
00526                         <span class="keywordflow">if</span> ((y &lt; 0) || (y &gt; nij)) <span class="keywordflow">continue</span>;
00527                         <a class="code" href="classRmMutableMatrix.html#a14">RmMutableMatrix&lt;T&gt;::valueAt</a>( i, j ) = inmap.<a class="code" href="classRmMutableMatrix.html#a14">valueAt</a>( x, y );
00528                 }
00529         }
00530 
00532         <span class="comment">// Correct for drift</span>
00533 
00534         <span class="comment">// . . . . . . .  Position A is the actual center of the image before rotation</span>
00535         <span class="comment">// . . . . . . .  After rotation by theta, that cell drifts to one of B, C, or D, as follows:</span>
00536         <span class="comment">// . . . . . . .    [315..45) : position A (no drift)</span>
00537         <span class="comment">// . . . A B . .    [45..135) : position B</span>
00538         <span class="comment">// . . . D C . .    [135..225): position C</span>
00539         <span class="comment">// . . . . . . .    [225..315): position D</span>
00540         <span class="comment">// . . . . . . .</span>
00541 
00542         <span class="comment">// Shift theta 45 degrees clockwise so that A is [0..90), B is [90..180), etc.</span>
00543         <span class="comment">// And divide into one of four quadrants</span>
00544         <span class="keywordtype">int</span> q = theta + 45;
00545         <span class="keywordflow">if</span> ( q &gt;= 360 ) q -= 360;
00546         <span class="keywordflow">switch</span>( q /= 90 ) 
00547         {
00548                 <span class="keywordflow">case</span> 0: <span class="comment">// A</span>
00549                         <span class="keywordflow">break</span>;
00550                 <span class="keywordflow">case</span> 1: <span class="comment">// B</span>
00551                         <a class="code" href="classRmMutableMatrix.html#a8">RmMutableMatrix&lt;T&gt;::resizeBy</a>( 0, 0, 1, -1 );
00552                         <span class="keywordflow">break</span>;
00553                 <span class="keywordflow">case</span> 2: <span class="comment">// C</span>
00554                         <a class="code" href="classRmMutableMatrix.html#a8">RmMutableMatrix&lt;T&gt;::resizeBy</a>( -1, 1, 1, -1 );
00555                         <span class="keywordflow">break</span>;
00556                 <span class="keywordflow">case</span> 3: <span class="comment">// D</span>
00557                         <a class="code" href="classRmMutableMatrix.html#a8">RmMutableMatrix&lt;T&gt;::resizeBy</a>( -1, 1, 0, 0 );
00558                         <span class="keywordflow">break</span>;
00559         }
00560 }
00561 
00562 
00563 
00564 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00565"></a><a class="code" href="classRmMutableMatrix.html#a7">00565</a> std::ostream&amp; <a class="code" href="classRmMutableMatrix.html#a7">RmMutableMatrix&lt;T&gt;::put</a>( std::ostream&amp; os, <span class="keyword">const</span> <span class="keywordtype">char</span> *format )<span class="keyword"> const</span>
00566 <span class="keyword"></span>{
00567         <span class="keyword">static</span> <span class="keywordtype">char</span> buff[10];
00568 
00569         <span class="keywordflow">for</span> ( std::vector&lt; std::vector&lt;T&gt; &gt;::const_iterator rows = m_2dVector.begin(); 
00570                 rows != m_2dVector.end(); ++rows )
00571         {
00572                 <span class="keywordflow">for</span> ( std::vector&lt;T&gt;::const_iterator cols = rows-&gt;begin(); cols != rows-&gt;end(); ++cols )
00573                 {
00574                         <span class="keywordflow">if</span> ( format != NULL ) {
00575                                 sprintf( buff, format, *cols );
00576                                 os &lt;&lt; buff &lt;&lt; m_colSep;
00577                         }
00578                         <span class="keywordflow">else</span> {
00579                                 os &lt;&lt; *cols &lt;&lt; m_colSep;
00580                         }
00581                 }
00582                 os &lt;&lt; m_rowSep;
00583         }
00584         <span class="keywordflow">return</span> os;
00585 }
00586 
00587 
00588 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
00589 std::ostream&amp; operator&lt;&lt; ( std::ostream&amp; os, const RmMutableMatrix&lt;T&gt;&amp; v )
00590 {
00591         <span class="keywordflow">return</span> v.<a class="code" href="classRmMutableMatrix.html#a7">put</a>( os );
00592 }
00593 
00594 
00595 
00596 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun May 1 23:40:03 2005 for Robot Mapper by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
