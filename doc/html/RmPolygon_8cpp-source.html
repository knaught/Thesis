<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Robot Mapper: src/RmPolygon.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">src</a></div>
<h1>RmPolygon.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">// RmPolygon.cpp</span>
00002 
00003 <span class="preprocessor">#pragma warning( disable : 4786 )</span>
00004 <span class="preprocessor"></span>
00005 <span class="preprocessor">#include "RmPolygon.h"</span>
00006 <span class="keyword">using</span> <a class="code" href="classRmUtility_1_1Coord.html">RmUtility::Coord</a>;
00007 
<a name="l00008"></a><a class="code" href="classRmPolygon.html#a15">00008</a> <a class="code" href="classRmPolygon.html#a15">RmPolygon::RmPolygon</a>( <span class="keyword">const</span> <a class="code" href="structRmUtility_1_1BoundBox.html">RmUtility::BoundBox</a> &amp;bound )
00009 {
00010         <span class="comment">// Modeled after </span>
00011         <span class="comment">// void gpc::gpc_read_polygon(FILE *fp, int read_hole_flags, gpc_polygon *p)</span>
00012 
00013         gpc_polygon *p = &amp;m_polygon;
00014         p-&gt;num_contours = 1;
00015         p-&gt;hole = <span class="keyword">new</span> <span class="keywordtype">int</span>[p-&gt;num_contours];
00016         p-&gt;contour = <span class="keyword">new</span> gpc_vertex_list[p-&gt;num_contours];
00017         <span class="keyword">const</span> <span class="keywordtype">int</span> c = 0;
00018     p-&gt;contour[c].num_vertices = 4;
00019         p-&gt;hole[c] = 0;
00020 
00021         p-&gt;contour[c].vertex = <span class="keyword">new</span> gpc_vertex[p-&gt;contour[c].num_vertices];
00022         p-&gt;contour[c].vertex[0].x = bound.<a class="code" href="structRmUtility_1_1BoundBox.html#o1">ul</a>.<a class="code" href="classRmUtility_1_1Coord.html#o0">x</a>;
00023         p-&gt;contour[c].vertex[0].<a class="code" href="classRmUtility_1_1Coord.html#o1">y</a> = bound.<a class="code" href="structRmUtility_1_1BoundBox.html#o1">ul</a>.<a class="code" href="classRmUtility_1_1Coord.html#o1">y</a>;
00024         p-&gt;contour[c].vertex[1].<a class="code" href="classRmUtility_1_1Coord.html#o0">x</a> = bound.<a class="code" href="structRmUtility_1_1BoundBox.html#o0">lr</a>.<a class="code" href="classRmUtility_1_1Coord.html#o0">x</a>;
00025         p-&gt;contour[c].vertex[1].<a class="code" href="classRmUtility_1_1Coord.html#o1">y</a> = bound.<a class="code" href="structRmUtility_1_1BoundBox.html#o1">ul</a>.<a class="code" href="classRmUtility_1_1Coord.html#o1">y</a>;
00026         p-&gt;contour[c].vertex[2].<a class="code" href="classRmUtility_1_1Coord.html#o0">x</a> = bound.<a class="code" href="structRmUtility_1_1BoundBox.html#o0">lr</a>.<a class="code" href="classRmUtility_1_1Coord.html#o0">x</a>;
00027         p-&gt;contour[c].vertex[2].<a class="code" href="classRmUtility_1_1Coord.html#o1">y</a> = bound.<a class="code" href="structRmUtility_1_1BoundBox.html#o0">lr</a>.<a class="code" href="classRmUtility_1_1Coord.html#o1">y</a>;
00028         p-&gt;contour[c].vertex[3].<a class="code" href="classRmUtility_1_1Coord.html#o0">x</a> = bound.<a class="code" href="structRmUtility_1_1BoundBox.html#o1">ul</a>.<a class="code" href="classRmUtility_1_1Coord.html#o0">x</a>;
00029         p-&gt;contour[c].vertex[3].<a class="code" href="classRmUtility_1_1Coord.html#o1">y</a> = bound.<a class="code" href="structRmUtility_1_1BoundBox.html#o0">lr</a>.<a class="code" href="classRmUtility_1_1Coord.html#o1">y</a>;
00030 
00031         <span class="comment">// Have native polygon code validate this bound</span>
00032         <span class="comment">// If invalid, will have num_contours of 0</span>
00033         <a class="code" href="classRmPolygon.html#a3">intersectWith</a>( *<span class="keyword">this</span> );
00034 }
00035 
00036 
<a name="l00037"></a><a class="code" href="classRmPolygon.html#a14">00037</a> <a class="code" href="classRmPolygon.html#a15">RmPolygon::RmPolygon</a>( <span class="keyword">const</span> gpc_polygon &amp;polygon )
00038 {
00039         <a class="code" href="classRmPolygon.html#b1">createFrom</a>( polygon );
00040 }
00041 
00042 
<a name="l00043"></a><a class="code" href="classRmPolygon.html#a13">00043</a> <a class="code" href="classRmPolygon.html#a15">RmPolygon::RmPolygon</a>( <span class="keyword">const</span> <a class="code" href="classRmPolygon.html">RmPolygon</a> &amp;polygon )
00044 {
00045         <a class="code" href="classRmPolygon.html#b1">createFrom</a>( polygon.<a class="code" href="classRmPolygon.html#r0">m_polygon</a> );
00046 }
00047 
00048 
<a name="l00049"></a><a class="code" href="classRmPolygon.html#a20">00049</a> <a class="code" href="classRmPolygon.html#a20">RmPolygon::~RmPolygon</a>()
00050 {
00051         <a class="code" href="classRmPolygon.html#b2">free</a>();
00052 }
00053 
00054 
<a name="l00055"></a><a class="code" href="classRmPolygon.html#a11">00055</a> <a class="code" href="classRmPolygon.html">RmPolygon</a>&amp; <a class="code" href="classRmPolygon.html#a11">RmPolygon::operator=</a>( <span class="keyword">const</span> <a class="code" href="classRmPolygon.html">RmPolygon</a> &amp;polygon )
00056 {
00057         <a class="code" href="classRmPolygon.html#b2">free</a>();
00058         <a class="code" href="classRmPolygon.html#b1">createFrom</a>( polygon.<a class="code" href="classRmPolygon.html#r0">m_polygon</a> );
00059         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00060 }
00061 
00062 
<a name="l00063"></a><a class="code" href="classRmPolygon.html#b1">00063</a> <span class="keywordtype">void</span> <a class="code" href="classRmPolygon.html#b1">RmPolygon::createFrom</a>( <span class="keyword">const</span> gpc_polygon &amp;polygon )
00064 {
00065         <span class="comment">// Modeled after </span>
00066         <span class="comment">// void gpc::gpc_read_polygon(FILE *fp, int read_hole_flags, gpc_polygon *p)</span>
00067 
00068         gpc_polygon *p = &amp;m_polygon;
00069         p-&gt;num_contours = polygon.num_contours;
00070         p-&gt;hole = <span class="keyword">new</span> <span class="keywordtype">int</span>[p-&gt;num_contours];
00071         p-&gt;contour = <span class="keyword">new</span> gpc_vertex_list[p-&gt;num_contours];
00072         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; p-&gt;num_contours; ++c ) {
00073                 p-&gt;hole[c] = polygon.hole[c];
00074                 p-&gt;contour[c].num_vertices = polygon.contour[c].num_vertices;
00075                 p-&gt;contour[c].vertex = <span class="keyword">new</span> gpc_vertex[p-&gt;contour[c].num_vertices];
00076                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> v = 0; v &lt; p-&gt;contour[c].num_vertices; ++v ) {
00077                         p-&gt;contour[c].vertex[v] = polygon.contour[c].vertex[v];
00078                 }
00079         }
00080 }
00081 
00082 
<a name="l00083"></a><a class="code" href="classRmPolygon.html#b2">00083</a> <span class="keywordtype">void</span> <a class="code" href="classRmPolygon.html#b2">RmPolygon::free</a>()
00084 {
00085         <span class="comment">// Modeled after </span>
00086         <span class="comment">// void gpc::gpc_free_polygon(gpc_polygon *p)</span>
00087 
00088         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; m_polygon.num_contours; ++c ) {
00089                 <span class="keyword">delete</span> [] m_polygon.contour[c].vertex;
00090         }
00091         <span class="keyword">delete</span> [] m_polygon.contour;
00092         <span class="keyword">delete</span> [] m_polygon.hole;
00093 }
00094 
00095 
<a name="l00096"></a><a class="code" href="classRmPolygon.html#a3">00096</a> <a class="code" href="classRmPolygon.html">RmPolygon</a>&amp; <a class="code" href="classRmPolygon.html#a3">RmPolygon::intersectWith</a>( <span class="keyword">const</span> <a class="code" href="classRmPolygon.html">RmPolygon</a> &amp;polygon )
00097 {
00098         <a class="code" href="classRmPolygon.html">RmPolygon</a> <a class="code" href="classRmPolygon.html#b0">clip</a>( polygon );
00099         gpc_polygon_clip( GPC_INT, &amp;m_polygon, &amp;clip.<a class="code" href="classRmPolygon.html#r0">m_polygon</a>, &amp;m_polygon );
00100         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00101 }
00102 
00103 
<a name="l00104"></a><a class="code" href="classRmPolygon.html#a2">00104</a> <a class="code" href="classRmPolygon.html">RmPolygon</a> <a class="code" href="classRmPolygon.html#a2">RmPolygon::intersectedWith</a>( <span class="keyword">const</span> <a class="code" href="classRmPolygon.html">RmPolygon</a> &amp;clip )<span class="keyword"> const</span>
00105 <span class="keyword"></span>{
00106         <a class="code" href="classRmPolygon.html">RmPolygon</a> subj( *<span class="keyword">this</span> );
00107         <span class="keywordflow">return</span> subj.<a class="code" href="classRmPolygon.html#a3">intersectWith</a>( clip );
00108 }
00109 
00110 
<a name="l00111"></a><a class="code" href="classRmPolygon.html#a17">00111</a> <a class="code" href="classRmPolygon.html">RmPolygon</a>&amp; <a class="code" href="classRmPolygon.html#a17">RmPolygon::subtractOut</a>( <span class="keyword">const</span> <a class="code" href="classRmPolygon.html">RmPolygon</a> &amp;polygon )
00112 {
00113         <a class="code" href="classRmPolygon.html">RmPolygon</a> <a class="code" href="classRmPolygon.html#b0">clip</a>( polygon );
00114         gpc_polygon_clip( GPC_DIFF, &amp;m_polygon, &amp;clip.<a class="code" href="classRmPolygon.html#r0">m_polygon</a>, &amp;m_polygon );
00115         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00116 }
00117 
00118 
<a name="l00119"></a><a class="code" href="classRmPolygon.html#a16">00119</a> <a class="code" href="classRmPolygon.html">RmPolygon</a> <a class="code" href="classRmPolygon.html#a16">RmPolygon::subtractedOut</a>( <span class="keyword">const</span> <a class="code" href="classRmPolygon.html">RmPolygon</a> &amp;clip )<span class="keyword"> const</span>
00120 <span class="keyword"></span>{
00121         <a class="code" href="classRmPolygon.html">RmPolygon</a> subj( *<span class="keyword">this</span> );
00122         <span class="keywordflow">return</span> subj.<a class="code" href="classRmPolygon.html#a17">subtractOut</a>( clip );
00123 }
00124 
00125 
<a name="l00126"></a><a class="code" href="classRmPolygon.html#a19">00126</a> <a class="code" href="classRmPolygon.html">RmPolygon</a>&amp; <a class="code" href="classRmPolygon.html#a19">RmPolygon::unionWith</a>( <span class="keyword">const</span> <a class="code" href="classRmPolygon.html">RmPolygon</a> &amp;polygon )
00127 {
00128         <a class="code" href="classRmPolygon.html">RmPolygon</a> <a class="code" href="classRmPolygon.html#b0">clip</a>( polygon );
00129         gpc_polygon_clip( GPC_UNION, &amp;m_polygon, &amp;clip.<a class="code" href="classRmPolygon.html#r0">m_polygon</a>, &amp;m_polygon );
00130         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00131 }
00132 
00133 
<a name="l00134"></a><a class="code" href="classRmPolygon.html#a18">00134</a> <a class="code" href="classRmPolygon.html">RmPolygon</a> <a class="code" href="classRmPolygon.html#a18">RmPolygon::unionedWith</a>( <span class="keyword">const</span> <a class="code" href="classRmPolygon.html">RmPolygon</a> &amp;clip )<span class="keyword"> const</span>
00135 <span class="keyword"></span>{
00136         <a class="code" href="classRmPolygon.html">RmPolygon</a> subj( *<span class="keyword">this</span> );
00137         <span class="keywordflow">return</span> subj.<a class="code" href="classRmPolygon.html#a19">unionWith</a>( clip );
00138 }
00139 
00140 
<a name="l00141"></a><a class="code" href="classRmPolygon.html#a12">00141</a> std::ostream&amp; <a class="code" href="classRmPolygon.html#a12">RmPolygon::put</a>( std::ostream &amp;os )<span class="keyword"> const</span>
00142 <span class="keyword"></span>{
00143         os &lt;&lt; m_polygon.num_contours &lt;&lt; <span class="stringliteral">"\n"</span>;
00144         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; m_polygon.num_contours; ++c ) {
00145                 os &lt;&lt; m_polygon.contour[c].num_vertices &lt;&lt; <span class="stringliteral">"\n"</span>;
00146                 os &lt;&lt; m_polygon.hole[c] &lt;&lt; <span class="stringliteral">"\n"</span>;
00147                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> v = 0; v &lt; m_polygon.contour[c].num_vertices; ++v ) {
00148                         os &lt;&lt; <span class="stringliteral">"  "</span> &lt;&lt; m_polygon.contour[c].vertex[v].x &lt;&lt; <span class="stringliteral">" "</span> 
00149                                 &lt;&lt; m_polygon.contour[c].vertex[v].y &lt;&lt; <span class="stringliteral">"\n"</span>;
00150                 }
00151         }
00152 
00153         <span class="keywordflow">return</span> os;
00154 }
00155 
00156 
00157 std::ostream&amp; operator&lt;&lt;( std::ostream &amp;os, <span class="keyword">const</span> <a class="code" href="classRmPolygon.html">RmPolygon</a> &amp;p )
00158 {
00159         <span class="keywordflow">return</span> p.<a class="code" href="classRmPolygon.html#a12">put</a>( os );
00160 }
00161 
00162 
<a name="l00163"></a><a class="code" href="classRmPolygon.html#a1">00163</a> <span class="keywordtype">void</span> <a class="code" href="classRmPolygon.html#a1">RmPolygon::fillInto</a>( std::vector&lt;Coord&gt; *fv )<span class="keyword"> const</span>
00164 <span class="keyword"></span>{
00165         <span class="comment">// For each contour polygon</span>
00166         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; m_polygon.num_contours; ++c )
00167         {
00168                 <span class="comment">// Skip holes</span>
00169                 <span class="keywordflow">if</span> ( m_polygon.hole[c] ) <span class="keywordflow">continue</span>; 
00170 
00171                 <span class="comment">// Convert points for use by polyfill routine</span>
00172                 <span class="keyword">struct </span>Point *points = <span class="keyword">new</span> Point[m_polygon.contour[c].num_vertices];
00173                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> v = 0; v &lt; m_polygon.contour[c].num_vertices; ++v ) {
00174                         points[v].X = static_cast&lt;int&gt;(m_polygon.contour[c].vertex[v].x);
00175                         points[v].Y = static_cast&lt;int&gt;(m_polygon.contour[c].vertex[v].y);
00176                 }
00177 
00178                 PointListHeader pointListHeader = { m_polygon.contour[c].num_vertices, points };
00179 
00180                 <span class="comment">// Fill contour</span>
00181                 PointList *<a class="code" href="classRmPolygon.html#a0">fill</a> = FillPolygon( 
00182                         &amp;pointListHeader, 0 <span class="comment">/*color*/</span>, NONCONVEX, 0 <span class="comment">/*x-offset*/</span>, 0 <span class="comment">/*y-offset*/</span> );
00183 
00184                 <span class="comment">// Push into vector</span>
00185                 <span class="keywordflow">while</span> ( fill ) {
00186                         fv-&gt;push_back( <a class="code" href="classRmUtility_1_1Coord.html">Coord</a>( fill-&gt;point.X, fill-&gt;point.Y ) );
00187                         fill = fill-&gt;next;
00188                 }
00189         }
00190 }
00191 
00192 
<a name="l00193"></a><a class="code" href="classRmPolygon.html#a0">00193</a> std::vector&lt;Coord&gt; <a class="code" href="classRmPolygon.html#a0">RmPolygon::fill</a>()<span class="keyword"> const</span>
00194 <span class="keyword"></span>{
00195         std::vector&lt;Coord&gt; fill;
00196         <a class="code" href="classRmPolygon.html#a1">fillInto</a>( &amp;fill );
00197         <span class="keywordflow">return</span> fill;
00198 }
00199 
00200 
<a name="l00201"></a><a class="code" href="classRmPolygon.html#e0">00201</a> std::vector&lt;Coord&gt; <a class="code" href="classRmPolygon.html#e0">RmPolygon::line</a>( <span class="keyword">const</span> <a class="code" href="classRmUtility_1_1Coord.html">Coord</a> &amp;from, <span class="keyword">const</span> <a class="code" href="classRmUtility_1_1Coord.html">Coord</a> &amp;to )
00202 {
00203         std::vector&lt;Coord&gt; line;
00204         PointList* linePointList = FillLine( from.<a class="code" href="classRmUtility_1_1Coord.html#o0">x</a>, from.<a class="code" href="classRmUtility_1_1Coord.html#o1">y</a>, to.<a class="code" href="classRmUtility_1_1Coord.html#o0">x</a>, to.<a class="code" href="classRmUtility_1_1Coord.html#o1">y</a> );  <span class="comment">// [start..end)</span>
00205         <span class="keywordflow">while</span> ( linePointList ) 
00206         {
00207                 line.push_back( <a class="code" href="classRmUtility_1_1Coord.html">Coord</a>( linePointList-&gt;point.X, linePointList-&gt;point.Y ) );
00208                 linePointList = linePointList-&gt;next;
00209         }
00210 
00211         <span class="keywordflow">return</span> line;
00212 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun May 1 23:40:03 2005 for Robot Mapper by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
