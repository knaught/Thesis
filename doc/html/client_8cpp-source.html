<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Robot Mapper: src/client.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">src</a></div>
<h1>client.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">// client.cpp</span>
00002 <span class="comment">// The client side of the client-server application that allows for remote control of robot</span>
00003 <span class="comment">// and mapping functionality.</span>
00004 
00005 
00006 <span class="preprocessor">#include &lt;conio.h&gt;</span>
00007 <span class="preprocessor">#include &lt;string&gt;</span>
00008 <span class="preprocessor">#include &lt;iostream&gt;</span>
00009 <span class="preprocessor">#include "RmExceptions.h"</span>
00010 <span class="preprocessor">#include "RmClient.h"</span>
00011 
00012 
00014 
00015 
<a name="l00019"></a><a class="code" href="structCommand.html">00019</a> <span class="keyword">struct </span><a class="code" href="structCommand.html">Command</a>
00020 {
<a name="l00022"></a><a class="code" href="structCommand.html#o2">00022</a>         std::string string;
00023         
<a name="l00026"></a><a class="code" href="structCommand.html#o1">00026</a>         <span class="keywordtype">bool</span> replyExpected;
00027 
<a name="l00029"></a><a class="code" href="structCommand.html#o0">00029</a>         <span class="keywordtype">bool</span> doQuit;
00030 
00031         <a class="code" href="structCommand.html">Command</a>() : string(), replyExpected(false), doQuit(false) {}
00032 };
00033 
00034 <a class="code" href="structCommand.html">Command</a> getUserCommand();
00035 
00036 
00038 
00039 
00044 <span class="keywordtype">void</span> main( <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* argv[] )
00045 {
00046         <span class="comment">//</span>
00047         <span class="comment">// Check for the host and port arguments</span>
00048         <span class="comment">//</span>
00049         <span class="keywordflow">if</span> (argc != 3)
00050         {
00051                 std::cerr &lt;&lt; <span class="stringliteral">"\nSyntax: "</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">" ServerName PortNumber\n"</span>;
00052                 <span class="keywordflow">return</span>;
00053         }
00054 
00055         <span class="keywordtype">short</span> nPort = atoi(argv[2]);
00056         <span class="keyword">const</span> std::string handshake( <span class="stringliteral">"Hello"</span> );
00057 
00058         <span class="keywordflow">try</span> {
00059                 <a class="code" href="classRmClient.html">RmClient</a> client( argv[1], nPort );
00060                 client.sendServerString( handshake );
00061                 <span class="keyword">const</span> std::string reply( client.getServerReply() );
00062                 std::cout &lt;&lt; <span class="stringliteral">"Remote Control Server says: "</span> &lt;&lt; reply &lt;&lt; <span class="stringliteral">"\n"</span>;
00063                 
00064                 std::cout 
00065                         &lt;&lt; <span class="stringliteral">"\nPlease use the following keyboard controls:\n"</span>
00066                         &lt;&lt; <span class="stringliteral">"  On/off : 'o' and Home key\n"</span>
00067                         &lt;&lt; <span class="stringliteral">"  Forward, Backward, Left, Right : Arrow keys, Numkey arrow keys\n"</span>
00068                         &lt;&lt; <span class="stringliteral">"  Stop : Spacebary Numkey 5\n"</span>
00069                         &lt;&lt; <span class="stringliteral">"  Change data file : d\n"</span>
00070                         &lt;&lt; <span class="stringliteral">"  Quit : q\n\n&gt; "</span>;
00071 
00072                 <a class="code" href="structCommand.html">Command</a> cmd;
00073                 <span class="keywordflow">while</span> ( !cmd.<a class="code" href="structCommand.html#o0">doQuit</a> ) 
00074                 {
00075                         cmd = getUserCommand();
00076                         client.sendServerString( cmd.<a class="code" href="structCommand.html#o2">string</a> );
00077                         <span class="keywordflow">if</span> ( cmd.<a class="code" href="structCommand.html#o1">replyExpected</a> ) 
00078                         {
00079                                 std::cout &lt;&lt; client.getServerReply() &lt;&lt; <span class="stringliteral">"\n&gt; "</span>;
00080                         }
00081                 }
00082         }
00083         <span class="keywordflow">catch</span>( <a class="code" href="structRmExceptions_1_1SocketException.html">RmExceptions::SocketException</a> e ) {
00084                 std::cerr &lt;&lt; <span class="stringliteral">"\n"</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">"::main() : "</span> &lt;&lt; e;
00085                 <span class="keywordflow">return</span>;
00086         }
00087 }
00088 
00089 
00094 <a class="code" href="structCommand.html">Command</a> getUserCommand()
00095 {
00096         <span class="keyword">static</span> <span class="keywordtype">bool</span> robotIsOn = <span class="keyword">false</span>;
00097         <span class="keywordtype">char</span> szBuf[256];
00098         szBuf[0] = <span class="charliteral">'\0'</span>;
00099 
00100         <a class="code" href="structCommand.html">Command</a> cmd;
00101         <span class="keywordtype">bool</span> getFilename = <span class="keyword">false</span>;
00102         <span class="keywordtype">bool</span> getCameraPose = <span class="keyword">false</span>;
00103 
00104         <span class="keywordflow">while</span> ( !kbhit() &amp;&amp; szBuf[0] == <span class="charliteral">'\0'</span> ) 
00105         {
00106                 <span class="keywordflow">switch</span>( getch() ) {
00107                         <span class="keywordflow">case</span> <span class="charliteral">'v'</span>: <span class="comment">// enable remote viewer</span>
00108                                 sprintf( szBuf, <span class="stringliteral">"viewer"</span> );
00109                                 printf( <span class="stringliteral">"v\nMode: "</span> );
00110                                 gets( szBuf + 1 );
00111                                 cmd.<a class="code" href="structCommand.html#o1">replyExpected</a> = <span class="keyword">true</span>;
00112                                 <span class="keywordflow">break</span>;
00113                         <span class="keywordflow">case</span> <span class="charliteral">'8'</span>:  <span class="comment">// #keypad arrow up</span>
00114                                 sprintf( szBuf, <span class="stringliteral">"forward"</span> );
00115                                 <span class="keywordflow">break</span>;
00116                         <span class="keywordflow">case</span> <span class="charliteral">'2'</span>:  <span class="comment">// #keypad arrow down</span>
00117                                 sprintf( szBuf, <span class="stringliteral">"back"</span> );
00118                                 <span class="keywordflow">break</span>;
00119                         <span class="keywordflow">case</span> <span class="charliteral">'4'</span>:  <span class="comment">// #keypad arrow left</span>
00120                                 sprintf( szBuf, <span class="stringliteral">"left"</span> );
00121                                 <span class="keywordflow">break</span>;
00122                         <span class="keywordflow">case</span> <span class="charliteral">'6'</span>:  <span class="comment">// #keypad arrow right</span>
00123                                 sprintf( szBuf, <span class="stringliteral">"right"</span> );
00124                                 <span class="keywordflow">break</span>;
00125                         <span class="keywordflow">case</span> <span class="charliteral">'5'</span>:  <span class="comment">// #keypad center</span>
00126                         <span class="keywordflow">case</span> <span class="charliteral">' '</span>:  <span class="comment">// space bar</span>
00127                                 sprintf( szBuf, <span class="stringliteral">"stop"</span> );
00128                                 <span class="keywordflow">break</span>;
00129                         <span class="keywordflow">case</span> <span class="charliteral">'w'</span>:
00130                                 sprintf( szBuf, <span class="stringliteral">"wander"</span> );
00131                                 <span class="keywordflow">break</span>;
00132                         <span class="keywordflow">case</span> <span class="charliteral">'o'</span>:
00133                                 sprintf( szBuf, robotIsOn ? <span class="stringliteral">"off"</span> : <span class="stringliteral">"on"</span> );
00134                                 robotIsOn = !robotIsOn;
00135                                 cmd.<a class="code" href="structCommand.html#o1">replyExpected</a> = robotIsOn;
00136                                 <span class="keywordflow">break</span>;
00137                         <span class="keywordflow">case</span> <span class="charliteral">'q'</span>:
00138                                 sprintf( szBuf, <span class="stringliteral">"quit"</span> );
00139                                 cmd.<a class="code" href="structCommand.html#o0">doQuit</a> = <span class="keyword">true</span>;
00140                                 <span class="keywordflow">break</span>;
00141                         <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00142                                 sprintf( szBuf, <span class="stringliteral">"d"</span> );
00143                                 printf( <span class="stringliteral">"d\nFilename: "</span> );
00144                                 gets( szBuf + 1 );
00145                                 cmd.<a class="code" href="structCommand.html#o1">replyExpected</a> = <span class="keyword">true</span>;
00146                                 <span class="keywordflow">break</span>;
00147                         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
00148                                 sprintf( szBuf, <span class="stringliteral">"c"</span> );
00149                                 printf( <span class="stringliteral">"c\nCamera pose: "</span> );
00150                                 gets( szBuf + 1 );
00151                                 cmd.<a class="code" href="structCommand.html#o1">replyExpected</a> = <span class="keyword">true</span>;
00152                                 <span class="keywordflow">break</span>;
00153                         <span class="keywordflow">case</span> 224: <span class="comment">// extended keys</span>
00154                                 <span class="keywordtype">int</span> c = getch();
00155                                 <span class="keywordflow">switch</span>( c ) {
00156                                         <span class="keywordflow">case</span> 72: <span class="comment">// Arrow up</span>
00157                                                 sprintf( szBuf, <span class="stringliteral">"forward"</span> );
00158                                                 <span class="keywordflow">break</span>;
00159                                         <span class="keywordflow">case</span> 80: <span class="comment">// Arrow down</span>
00160                                                 sprintf( szBuf, <span class="stringliteral">"back"</span> );
00161                                                 <span class="keywordflow">break</span>;
00162                                         <span class="keywordflow">case</span> 75: <span class="comment">// Arrow left</span>
00163                                                 sprintf( szBuf, <span class="stringliteral">"left"</span> );
00164                                                 <span class="keywordflow">break</span>;
00165                                         <span class="keywordflow">case</span> 77: <span class="comment">// Arrow right</span>
00166                                                 sprintf( szBuf, <span class="stringliteral">"right"</span> );
00167                                                 <span class="keywordflow">break</span>;
00168                                         <span class="keywordflow">case</span> 71: <span class="comment">// Home key</span>
00169                                                 sprintf( szBuf, robotIsOn ? <span class="stringliteral">"off"</span> : <span class="stringliteral">"on"</span> );
00170                                                 robotIsOn = !robotIsOn;
00171                                                 <span class="keywordflow">break</span>;
00172                                         <span class="keywordflow">case</span> 79: <span class="comment">// End key</span>
00173                                                 sprintf( szBuf, <span class="stringliteral">"stop"</span> );
00174                                                 <span class="keywordflow">break</span>;
00175                                         <span class="keywordflow">default</span>:
00176                                                 printf( <span class="stringliteral">"%d"</span>, c );
00177                                                 <span class="keywordflow">break</span>;
00178                                 }
00179                                 <span class="keywordflow">break</span>;
00180                 }
00181         }
00182 
00183         <span class="comment">// Clear the buffer</span>
00184         <span class="keywordflow">while</span> ( kbhit() ) getch();
00185         
00186         <span class="keywordflow">if</span> ( !cmd.<a class="code" href="structCommand.html#o1">replyExpected</a> ) printf( <span class="stringliteral">"%s\n&gt; "</span>, szBuf );
00187 
00188         cmd.<a class="code" href="structCommand.html#o2">string</a> = std::string( szBuf );
00189 
00190         <span class="keywordflow">return</span> cmd;
00191 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun May 1 23:40:03 2005 for Robot Mapper by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
