<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Robot Mapper: src/RmJavaGridModel.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000001.html">src</a></div>
<h1>RmJavaGridModel.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">// RmJavaGridModel.cpp</span>
00002 
00003 <span class="preprocessor">#pragma warning( disable : 4786 )</span>
00004 <span class="preprocessor"></span>
00005 <span class="preprocessor">#include &lt;jni.h&gt;</span>
00006 <span class="preprocessor">#include "RmJavaGridModel.h"</span>
00007 
00008 <span class="preprocessor">#include &lt;fstream&gt;</span>
00009 <span class="preprocessor">#include &lt;iostream&gt;</span>
00010 <span class="preprocessor">#include "RmSonarMapper.h"</span>
00011 <span class="preprocessor">#include "RmSettings.h"</span>
00012 <span class="preprocessor">#include "RmUtility.h"</span>
00013 <span class="preprocessor">#include "RmPioneerController.h"</span>
00014 <span class="preprocessor">#include "RmExceptions.h"</span>
00015 <span class="preprocessor">#include "RmGlobalMap.h"</span>
00016 
00017 <span class="keyword">static</span> std::ifstream g_ifStream;
00018 <span class="keyword">static</span> std::ofstream g_ofStream;
00019 <span class="keyword">static</span> <span class="keywordtype">int</span> g_dataSource;
00020 <span class="keyword">static</span> <span class="keywordtype">int</span> g_sonarNumber = 0;
00021 
00022 <a class="code" href="struct_rm_settings.html">RmSettings</a> g_settings;
00023 <a class="code" href="class_rm_global_map.html">RmGlobalMap</a> g_grid( &amp;g_settings );
00024 std::vector&lt;RmActionHandler*&gt; g_actionHandlers;
00025 <a class="code" href="class_rm_sonar_mapper.html">RmSonarMapper</a> g_sonarMapper( g_settings, &amp;g_grid );
00026 
00027 
00028 <span class="keyword">struct </span>Listener
00029 {
00030         jobject object;
00031         jmethodID methodID;
00032 };
00033 
00034 <span class="keyword">static</span> JNIEnv* s_env = NULL;
00035 <span class="keyword">static</span> Listener* s_listener = NULL;
00036 ArRobot* g_robot;
00037 
00038 
00039 <span class="keywordtype">void</span> fireMapUpdateEvent( std::string eventString )
00040 {
00041         <span class="comment">//std::cerr &lt;&lt; "RmJavaGridModel.cpp fireMapUpdateEvent()\n";</span>
00042         <span class="keywordflow">if</span> ( s_env != NULL &amp;&amp; s_listener != NULL ) {
00043                 jstring jstr = s_env-&gt;NewStringUTF( eventString.c_str() );
00044                 s_env-&gt;CallVoidMethod( s_listener-&gt;object, s_listener-&gt;methodID, jstr );
00045         }
00046 }
00047 
00048 
00049 JNIEXPORT <span class="keywordtype">void</span> JNICALL
00050 Java_GridModel_setMapUpdateListener( JNIEnv *env, jobject obj, jobject listener )
00051 {
00052         s_env = env;
00053         jclass cls = env-&gt;GetObjectClass( listener );
00054         jmethodID mid = env-&gt;GetMethodID( cls, <span class="stringliteral">"mapUpdateFired"</span>, <span class="stringliteral">"(Ljava/lang/String;)V"</span> );
00055         <span class="keywordflow">if</span> ( mid != NULL ) 
00056         {
00057                 <span class="comment">// Install listener</span>
00058                 s_listener = <span class="keyword">new</span> Listener();
00059                 s_listener-&gt;object = obj;
00060                 s_listener-&gt;methodID = mid;
00061         }
00062         <span class="keywordflow">else</span> {
00063                 printf( <span class="stringliteral">"Java_GridModel_setMapUpdateListener(): Unable to install listener.\n"</span> );
00064         }
00065 }
00066 
00067 
00068 JNIEXPORT jint JNICALL
00069 Java_GridModel_openLiveConnection( JNIEnv *env, jobject obj, jstring filename, jboolean wander )
00070 {
00071         <span class="keyword">const</span> <span class="keywordtype">char</span> *cfilename = env-&gt;GetStringUTFChars( filename, 0 );
00072 
00073         <span class="keywordflow">try</span> {
00074                 <span class="comment">// Open log file for write</span>
00075                 g_ofStream.open( cfilename );
00076                 <span class="keywordflow">if</span> ( !g_ofStream.good() ) {
00077                         <span class="keywordflow">throw</span> <a class="code" href="struct_rm_exceptions_1_1_i_o_exception.html">RmExceptions::IOException</a>( <span class="stringliteral">"Java_GridModel_openLiveConnection()"</span>, 
00078                                 <span class="stringliteral">"Unable to open sonar output file."</span> );
00079                 }
00080 
00081                 <a class="code" href="class_rm_sonar_mapper.html">RmSonarMapper</a>* sonarRecorder = <span class="keyword">new</span> <a class="code" href="class_rm_sonar_mapper.html">RmSonarMapper</a>( g_settings, g_ofStream, &amp;g_grid );
00082                 g_actionHandlers.empty();
00083                 g_actionHandlers.push_back( sonarRecorder );
00084                 <a class="code" href="class_rm_pioneer_controller.html">RmPioneerController</a> robot( <span class="keyword">false</span>, <span class="keyword">true</span>, &amp;g_actionHandlers );
00085                 <span class="keywordflow">if</span> ( robot.getConnectionStatus() == RmPioneerController::FAILED ) {
00086                         <span class="keywordflow">throw</span> <a class="code" href="struct_rm_exceptions_1_1_exception.html">RmExceptions::Exception</a>( NULL, <span class="stringliteral">"Java_GridModel_openLiveConnection()"</span>, 
00087                                 <span class="stringliteral">"Unable to establish connection with simulator or robot."</span> );
00088                 }
00089         }
00090         <span class="keywordflow">catch</span>( <a class="code" href="struct_rm_exceptions_1_1_exception.html">RmExceptions::Exception</a> e ) {
00091                 env-&gt;ReleaseStringUTFChars( filename, cfilename );
00092                 std::cerr &lt;&lt; e &lt;&lt; <span class="stringliteral">"\n"</span>;
00093                 <span class="keywordflow">return</span> 1;
00094         }
00095 
00096         <span class="keywordflow">return</span> 0;
00097 }
00098 
00099 
00100 JNIEXPORT jint JNICALL  <span class="comment">// openConnection( const char* filename )</span>
00101 Java_GridModel_openFileConnection( JNIEnv *env, jobject obj, jstring filename )
00102 {
00103         <span class="keyword">const</span> <span class="keywordtype">char</span> *cfilename = env-&gt;GetStringUTFChars( filename, 0 );
00104         <span class="keywordflow">try</span> {
00105                 <span class="keywordflow">if</span> ( g_ifStream.is_open() ) g_ifStream.close();
00106                 g_ifStream.open( cfilename );
00107                 <span class="keywordflow">if</span> ( !g_ifStream.good() ) <span class="keywordflow">throw</span> <a class="code" href="struct_rm_exceptions_1_1_i_o_exception.html">RmExceptions::IOException</a>( 
00108                         <span class="stringliteral">"Java_GridModel_openFileConnection()"</span>, <span class="stringliteral">"Unable to open input file."</span> );
00109         }
00110         <span class="keywordflow">catch</span>( <a class="code" href="struct_rm_exceptions_1_1_exception.html">RmExceptions::Exception</a> e ) {
00111                 env-&gt;ReleaseStringUTFChars( filename, cfilename );
00112                 std::cerr &lt;&lt; e &lt;&lt; <span class="stringliteral">"\n"</span>;
00113                 <span class="keywordflow">return</span> 1;
00114         }
00115         
00116         <span class="keywordflow">return</span> 0;
00117 }
00118 
00119 
00120 JNIEXPORT jint JNICALL 
00121 Java_GridModel_resetFileConnection( JNIEnv *env, jobject obj )
00122 {
00123         <span class="keywordflow">try</span> {
00124                 g_ifStream.clear();
00125                 <span class="keywordflow">if</span> ( !g_ifStream.is_open() ) <span class="keywordflow">throw</span> <a class="code" href="struct_rm_exceptions_1_1_i_o_exception.html">RmExceptions::IOException</a>( 
00126                         <span class="stringliteral">"Java_GridModel_resetFileConnection()"</span>, <span class="stringliteral">"Connection not open."</span> );
00127                 g_ifStream.seekg( 0 );
00128                 <span class="keywordflow">if</span> ( !g_ifStream.good() ) <span class="keywordflow">throw</span> <a class="code" href="struct_rm_exceptions_1_1_i_o_exception.html">RmExceptions::IOException</a>( 
00129                         <span class="stringliteral">"Java_GridModel_resetFileConnection()"</span>, <span class="stringliteral">"Connection reset failed."</span> );
00130         }
00131         <span class="keywordflow">catch</span>( <a class="code" href="struct_rm_exceptions_1_1_exception.html">RmExceptions::Exception</a> e ) {
00132                 std::cerr &lt;&lt; e &lt;&lt; <span class="stringliteral">"\n"</span>;
00133                 <span class="keywordflow">return</span> 1;
00134         }
00135 
00136         g_grid.<a class="code" href="class_rm_global_map.html#a3">empty</a>();
00137         g_sonarNumber = 0;
00138 
00139         <span class="keywordflow">return</span> 0;
00140 }
00141 
00142 
00143 JNIEXPORT <span class="keywordtype">void</span> JNICALL
00144 Java_GridModel_clearMap( JNIEnv *env, jobject obj )
00145 {
00146         g_grid.<a class="code" href="class_rm_global_map.html#a1">clear</a>();
00147 }
00148 
00149 
00150 JNIEXPORT <span class="keywordtype">void</span> JNICALL
00151 Java_GridModel_emptyMap( JNIEnv *env, jobject obj )
00152 {
00153         g_grid.<a class="code" href="class_rm_global_map.html#a3">empty</a>();
00154         g_sonarMapper.<a class="code" href="class_rm_sonar_mapper.html#a3">reset</a>();
00155 }
00156 
00157 
00158 JNIEXPORT <span class="keywordtype">void</span> JNICALL
00159 Java_GridModel_runMapper( JNIEnv *env, jobject obj )
00160 {
00161         <span class="keywordflow">if</span> ( !g_ofStream.is_open() ) {
00162                 std::cerr &lt;&lt; <span class="stringliteral">"Java_GridModel_runMapper(): Connection not open.\n"</span>;
00163                 <span class="keywordflow">return</span>;
00164         }
00165 
00166         <span class="comment">// Start 'er up!</span>
00167         <span class="keywordflow">if</span> ( g_robot ) {
00168                 g_robot-&gt;setVel( 40.0 );
00169                 g_robot-&gt;runAsync( <span class="keyword">true</span> );
00170         }
00171 }
00172 
00173 
00178 std::ifstream &amp;getLine( std::ifstream &amp;is, <span class="keywordtype">char</span> *buffer, <span class="keywordtype">int</span> size )
00179 {
00180         <span class="keywordflow">do</span> <span class="keywordflow">if</span> ( !is.getline( buffer, size ) ) <span class="keywordflow">break</span>;
00181         <span class="keywordflow">while</span> ( buffer[0] == <span class="charliteral">'%'</span> ); <span class="comment">// skip comments</span>
00182 
00183         <span class="keywordflow">return</span> is;
00184 }
00185 
00186 
00191 std::string getLine( std::ifstream &amp;is )
00192 {
00193         <span class="keyword">const</span> <span class="keywordtype">int</span> BufSize = 120;
00194         <span class="keywordtype">char</span> buff[BufSize];
00195         std::string line;
00196 
00197         <span class="comment">// get next non-comment line</span>
00198         <span class="keywordflow">do</span> 
00199         {
00200                 is.getline( buff, BufSize );
00201 
00202                 <span class="comment">// get one newline-terminated line of unspecified length</span>
00203                 <span class="keywordflow">while</span> ( !is.eof() ) 
00204                 {
00205                         line.append( buff );
00206 
00207                         <span class="comment">// bolt if we've read end of line (vice hitting buffer size)</span>
00208                         <span class="keywordflow">if</span> ( is.gcount() &lt; BufSize - 2 ) <span class="keywordflow">break</span>;
00209 
00210                         <span class="comment">// for gcount() of 118, 119, or 120, newline is next character</span>
00211                         <span class="keywordflow">if</span> ( is.peek() == <span class="charliteral">'\n'</span> ) <span class="keywordflow">break</span>;
00212 
00213                         <span class="comment">// flags are raised when BufSize is reached; ignore them</span>
00214                         is.clear();
00215 
00216                         is.getline( buff, BufSize, <span class="charliteral">'\n'</span> );
00217                 }
00218 
00219         } <span class="keywordflow">while</span> ( !is.eof() &amp;&amp; line[0] == <span class="charliteral">'%'</span> );
00220 
00221         <span class="comment">//std::cerr &lt;&lt; "RmJavaGridModel::getLine() : " &lt;&lt; line &lt;&lt; "\n";</span>
00222 
00223         <span class="keywordflow">return</span> line;
00224 }
00225 
00226 
00231 JNIEXPORT jstring JNICALL
00232 Java_GridModel_stepSonarMapper( JNIEnv *env, jobject obj )
00233 {
00234         <span class="comment">// This routine statically stores a single line of sonar data</span>
00235         <span class="comment">// and then iterates through the range readings each time it is called.</span>
00236 
00237         <span class="keywordflow">if</span> ( !g_ifStream.is_open() ) {
00238                 std::cerr &lt;&lt; <span class="stringliteral">"Java_GridModel_stepMapper(): Connection not open.\n"</span>;
00239                 <span class="keywordflow">return</span> NULL;
00240         }
00241 
00242         <span class="keyword">static</span> <a class="code" href="struct_rm_utility_1_1_sonar_reading.html">RmUtility::SonarReading</a> reading;
00243 
00244         <span class="comment">// Repeat until in-range sonar reading is found or end of file is hit</span>
00245         std::string dataString;
00246         <span class="keywordflow">do</span> {
00247                 <span class="comment">// If looking for first sonar reading, process a new line of data</span>
00248                 <span class="keywordflow">if</span> ( g_sonarNumber == 0 ) 
00249                 {
00250                         <span class="keywordtype">char</span> buffer[120];
00251                         <span class="keywordflow">if</span> ( !getLine( g_ifStream, buffer, 120 ) ) <span class="keywordflow">return</span> NULL;
00252 
00253                         <span class="comment">// Skip comments</span>
00254                         <span class="keywordflow">if</span> ( buffer[0] == <span class="charliteral">'%'</span> ) <span class="keywordflow">continue</span>;
00255 
00256                         <span class="comment">// Extract SonarReading</span>
00257                         reading = <a class="code" href="struct_rm_utility_1_1_sonar_reading.html">RmUtility::SonarReading</a>( buffer );
00258                 }
00259 
00260                 <span class="comment">// Map single sonar reading</span>
00261                 <span class="keywordflow">try</span> {
00262                         dataString = g_sonarMapper.<a class="code" href="class_rm_sonar_mapper.html#a1">mapReading</a>( &amp;reading, g_sonarNumber );
00263                 } <span class="keywordflow">catch</span> ( <a class="code" href="struct_rm_exceptions_1_1_exception.html">RmExceptions::Exception</a> e ) {
00264                         std::cerr &lt;&lt; <span class="stringliteral">"Exception caught in Java_GridModel_stepSonarMapper()\n"</span> &lt;&lt; e &lt;&lt; <span class="stringliteral">"\n"</span>;
00265                         <span class="keywordflow">throw</span>; <span class="comment">// force JVM to crash</span>
00266                 }
00267 
00268                 <span class="comment">// Move to the next range reading</span>
00269                 <span class="keywordflow">if</span> ( ++g_sonarNumber &gt; 15 ) g_sonarNumber = 0;
00270         } <span class="keywordflow">while</span> ( dataString.length() == 0 );
00271 
00272 <span class="comment">//      std::cout &lt;&lt; "[" &lt;&lt; dataString &lt;&lt; "]:" &lt;&lt; dataString.length() &lt;&lt; "\n";</span>
00273         <span class="keywordflow">return</span> env-&gt;NewStringUTF( dataString.c_str() );
00274 }
00275 
00276 
00282 JNIEXPORT jstring JNICALL
00283 Java_GridModel_stepLogMapper( JNIEnv *env, jobject obj )
00284 {
00285         <span class="keywordflow">if</span> ( !g_ifStream.is_open() ) {
00286                 std::cerr &lt;&lt; <span class="stringliteral">"Java_GridModel_stepLogMapper(): Connection not open.\n"</span>;
00287                 <span class="keywordflow">return</span> NULL;
00288         }
00289 
00290         <span class="comment">// Read next log data entry from file</span>
00291         std::string dataString;
00292         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; g_ifStream &amp;&amp; i &lt; 3; ++i ) {
00293                 dataString.append( getLine( g_ifStream ) + <span class="stringliteral">"\n"</span> );
00294         }
00295 
00296 <span class="comment">//      g_visionMap.update( dataString );</span>
00297 
00298         <span class="keywordflow">return</span> i != 3 ? NULL : env-&gt;NewStringUTF( dataString.c_str() );
00299 }
00300 
00301 
00307 JNIEXPORT jstring JNICALL
00308 Java_GridModel_localize( JNIEnv *env, jobject obj )
00309 {
00310 <span class="comment">//      return env-&gt;NewStringUTF( g_grid.localize().c_str() );</span>
00311         <span class="keywordflow">return</span> env-&gt;NewStringUTF( <span class="stringliteral">""</span> );
00312 }
00313 
00314 
00320 JNIEXPORT jstring JNICALL
00321 Java_GridModel_integrate( JNIEnv *env, jobject obj )
00322 {
00323         <span class="comment">// return env-&gt;NewStringUTF( g_grid.integrate().c_str() );</span>
00324         <span class="keywordflow">return</span> env-&gt;NewStringUTF( <span class="stringliteral">""</span> );
00325 }
00326 
00327 
00328 
00329 JNIEXPORT jint JNICALL
00330 Java_GridModel_saveMap( JNIEnv *env, jobject obj, jstring filename )
00331 {
00332         <span class="keyword">const</span> <span class="keywordtype">char</span> *cfilename = env-&gt;GetStringUTFChars( filename, 0 );
00333         <span class="keywordflow">try</span> {
00334                 <span class="keywordflow">if</span> ( *cfilename == 0 ) <span class="keywordflow">throw</span> <a class="code" href="struct_rm_exceptions_1_1_i_o_exception.html">RmExceptions::IOException</a>( 
00335                         <span class="stringliteral">"Java_GridModel_saveMap()"</span>, <span class="stringliteral">"Filename unspecified."</span> );
00336                 std::ofstream fout( cfilename );
00337                 <span class="keywordflow">if</span>( !fout ) <span class="keywordflow">throw</span> <a class="code" href="struct_rm_exceptions_1_1_i_o_exception.html">RmExceptions::IOException</a>( 
00338                         <span class="stringliteral">"Java_GridModel_saveMap()"</span>, <span class="stringliteral">"Unable to open output file."</span> );
00339                 g_grid.<a class="code" href="class_rm_global_map.html#a8">put</a>( fout );
00340                 fout.close();
00341         }
00342         <span class="keywordflow">catch</span>( <a class="code" href="struct_rm_exceptions_1_1_exception.html">RmExceptions::Exception</a> e )      {
00343                 env-&gt;ReleaseStringUTFChars( filename, cfilename );
00344                 std::cerr &lt;&lt; e &lt;&lt; <span class="stringliteral">"\n"</span>;
00345                 <span class="keywordflow">return</span> 1;
00346         }
00347 
00348         <span class="keywordflow">return</span> 0;
00349 }
00350 
00351 
00352 JNIEXPORT <span class="keywordtype">void</span> JNICALL
00353 Java_GridModel_setSonarModel( JNIEnv *env, jobject obj, jint model )
00354 {
00355         g_settings.<a class="code" href="struct_rm_settings.html#o19">SonarModel</a> = (RmUtility::SonarModelEnum)model;
00356 }
00357 
00358 
00359 JNIEXPORT jint JNICALL
00360 Java_GridModel_getSonarModel( JNIEnv *env, jobject obj )
00361 {
00362         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o19">SonarModel</a>;
00363 }
00364 
00365 
00366 JNIEXPORT <span class="keywordtype">void</span> JNICALL
00367 Java_GridModel_setSonarEnabled( JNIEnv *env, jobject obj, jint sonarNumber, jboolean enabled)
00368 {
00369         g_settings.<a class="code" href="struct_rm_settings.html#o3">EnabledSonars</a>[sonarNumber] = enabled;
00370 }
00371 
00372 
00373 JNIEXPORT jint JNICALL
00374 Java_GridModel_setCellSize( JNIEnv *env, jobject obj, jint v )
00375 {
00376         <span class="keywordflow">return</span> ( v &lt; 1 || v &gt; 500 ) ? -1 : g_settings.<a class="code" href="struct_rm_settings.html#o2">CellSize</a> = v;
00377 }
00378 
00379 
00380 JNIEXPORT jint JNICALL
00381 Java_GridModel_getCellSize( JNIEnv *env, jobject obj )
00382 {
00383         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o2">CellSize</a>;
00384 }
00385 
00386 
00387 JNIEXPORT jint JNICALL
00388 Java_GridModel_setSonarBeta( JNIEnv *env, jobject obj, jint v )
00389 {
00390         <span class="keywordflow">return</span> ( v &lt; 7 || v &gt; 90 ) ? -1 : g_settings.<a class="code" href="struct_rm_settings.html#o1">Beta</a> = v;
00391 }
00392 
00393 
00394 JNIEXPORT jint JNICALL
00395 Java_GridModel_getSonarBeta( JNIEnv *env, jobject obj )
00396 {
00397         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o1">Beta</a>;
00398 }
00399 
00400 
00401 JNIEXPORT jfloat JNICALL
00402 Java_GridModel_setMaxOccupied( JNIEnv *env, jobject obj, jfloat v )
00403 {
00404         <span class="keywordflow">return</span> ( v &lt; 0 || v &gt; 1 ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o12">MaxOccupied</a> = v;
00405 }
00406 
00407 
00408 JNIEXPORT jfloat JNICALL
00409 Java_GridModel_getMaxOccupied( JNIEnv *env, jobject obj )
00410 {
00411         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o12">MaxOccupied</a>;
00412 }
00413 
00414 
00415 JNIEXPORT jfloat JNICALL
00416 Java_GridModel_setMaxOccupiedII( JNIEnv *env, jobject obj, jfloat v )
00417 {
00418         <span class="keywordflow">return</span> ( v &lt; 0 || v &gt; 1 ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o11">MaxEmpty</a> = v;
00419 }
00420 
00421 
00422 JNIEXPORT jfloat JNICALL
00423 Java_GridModel_getMaxOccupiedII( JNIEnv *env, jobject obj )
00424 {
00425         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o11">MaxEmpty</a>;
00426 }
00427 
00428 
00429 JNIEXPORT jint JNICALL
00430 Java_GridModel_setRegionIWidth( JNIEnv *env, jobject obj, jint v )
00431 {
00432         <span class="keywordflow">return</span> ( v &lt; 1 || v &gt; 1000 ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o17">RegionIHalfwidth</a> = v / 2;
00433 }
00434 
00435 
00436 JNIEXPORT jint JNICALL
00437 Java_GridModel_getRegionIWidth( JNIEnv *env, jobject obj )
00438 {
00439         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o17">RegionIHalfwidth</a> * 2;
00440 }
00441 
00442 
00443 JNIEXPORT <span class="keywordtype">void</span> JNICALL
00444 Java_GridModel_setIgnoreOutOfRange( JNIEnv *env, jobject obj, jboolean v )
00445 {
00446         g_settings.<a class="code" href="struct_rm_settings.html#o6">IgnoreOutOfRange</a> = v;
00447 }
00448 
00449 
00450 JNIEXPORT jboolean JNICALL
00451 Java_GridModel_getIgnoreOutOfRange( JNIEnv *env, jobject obj )
00452 {
00453         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o6">IgnoreOutOfRange</a>;
00454 }
00455 
00456 
00457 JNIEXPORT jint JNICALL
00458 Java_GridModel_setOutOfRangeConversion( JNIEnv *env, jobject obj, jint v )
00459 {
00460         std::cerr &lt;&lt; <span class="stringliteral">"Java_GridModel_setOutOfRangeConversion(): "</span> &lt;&lt; v &lt;&lt; <span class="stringliteral">"\n"</span>;
00461         <span class="keywordflow">return</span> ( v &lt; 1 || v &gt; RmPioneerController::SonarRange ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o15">OutOfRangeConversion</a> = v;
00462 }
00463 
00464 
00465 JNIEXPORT jint JNICALL
00466 Java_GridModel_getOutOfRangeConversion( JNIEnv *env, jobject obj )
00467 {
00468         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o15">OutOfRangeConversion</a>;
00469 }
00470 
00471 
00472 JNIEXPORT <span class="keywordtype">void</span> JNICALL
00473 Java_GridModel_setIgnoreObstructed( JNIEnv *env, jobject obj, jboolean v )
00474 {
00475         g_settings.<a class="code" href="struct_rm_settings.html#o5">IgnoreObstructed</a> = v;
00476 }
00477 
00478 
00479 JNIEXPORT jboolean JNICALL
00480 Java_GridModel_getIgnoreObstructed( JNIEnv *env, jobject obj )
00481 {
00482         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o5">IgnoreObstructed</a>;
00483 }
00484 
00485 
00486 JNIEXPORT jint JNICALL
00487 Java_GridModel_getLocalMapSize( JNIEnv *env, jobject obj )
00488 {
00489         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o8">LocalMapDistance</a>;
00490 }
00491 
00492 
00493 JNIEXPORT jint JNICALL
00494 Java_GridModel_setLocalMapSize( JNIEnv *env, jobject obj, jint v )
00495 {
00496         <span class="keywordflow">return</span> ( v != 0 &amp;&amp; (v &lt; 100 || v &gt; 25000) ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o8">LocalMapDistance</a> = v;
00497 }
00498 
00499 
00500 JNIEXPORT jboolean JNICALL
00501 Java_GridModel_getLocalizationEnabled( JNIEnv *env, jobject obj )
00502 {
00503         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o7">Localize</a>;
00504 }
00505 
00506 
00507 JNIEXPORT <span class="keywordtype">void</span> JNICALL
00508 Java_GridModel_setLocalizationEnabled( JNIEnv *env, jobject obj, jboolean v )
00509 {
00510         g_settings.<a class="code" href="struct_rm_settings.html#o7">Localize</a> = v;
00511 }
00512 
00513 
00514 JNIEXPORT jfloat JNICALL
00515 Java_GridModel_getObstructedCertainty( JNIEnv *env, jobject obj )
00516 {
00517         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o14">ObstructedCertainty</a>;
00518 }
00519 
00520 
00521 JNIEXPORT jfloat JNICALL
00522 Java_GridModel_setObstructedCertainty( JNIEnv *env, jobject obj, jfloat v )
00523 {
00524         <span class="keywordflow">return</span> ( v &lt; 0 || v &gt; 1 ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o14">ObstructedCertainty</a> = v;
00525 }
00526 
00527 
00528 JNIEXPORT jint JNICALL
00529 Java_GridModel_getMotionMinHeight( JNIEnv *env, jobject obj )
00530 {
00531         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o2">MinHeight</a>;
00532 }
00533 
00534 
00535 JNIEXPORT jint JNICALL
00536 Java_GridModel_setMotionMinHeight( JNIEnv *env, jobject obj, jint v )
00537 {
00538         <span class="keywordflow">return</span> ( v &lt; 0 || v &gt; 50 ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o2">MinHeight</a> = v;
00539 }
00540 
00541 
00542 JNIEXPORT jint JNICALL
00543 Java_GridModel_getMotionMinWidth( JNIEnv *env, jobject obj )
00544 {
00545         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o3">MinWidth</a>;
00546 }
00547 
00548 
00549 JNIEXPORT jint JNICALL
00550 Java_GridModel_setMotionMinWidth( JNIEnv *env, jobject obj, jint v )
00551 {
00552         <span class="keywordflow">return</span> ( v &lt; 0 || v &gt; 50 ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o3">MinWidth</a> = v;
00553 }
00554 
00555 
00556 JNIEXPORT jint JNICALL
00557 Java_GridModel_getMotionUnitDistance( JNIEnv *env, jobject obj )
00558 {
00559         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o4">UnitDistance</a>;
00560 }
00561 
00562 
00563 JNIEXPORT jint JNICALL
00564 Java_GridModel_setMotionUnitDistance( JNIEnv *env, jobject obj, jint v )
00565 {
00566         <span class="keywordflow">return</span> ( v &lt; 1 || v &gt; 1000 ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o4">UnitDistance</a> = v;
00567 }
00568 
00569 
00570 JNIEXPORT jint JNICALL
00571 Java_GridModel_getMotionUnitTurn( JNIEnv *env, jobject obj )
00572 {
00573         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o5">UnitTurn</a>;
00574 }
00575 
00576 
00577 JNIEXPORT jint JNICALL
00578 Java_GridModel_setMotionUnitTurn( JNIEnv *env, jobject obj, jint v )
00579 {
00580         <span class="keywordflow">return</span> ( v &lt; 1 || v &gt; 360 ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o5">UnitTurn</a> = v;
00581 }
00582 
00583 
00584 JNIEXPORT jfloat JNICALL
00585 Java_GridModel_getMotionGaussSigma( JNIEnv *env, jobject obj )
00586 {
00587         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o1">GaussianSigma</a>;
00588 }
00589 
00590 
00591 JNIEXPORT jfloat JNICALL
00592 Java_GridModel_setMotionGaussSigma( JNIEnv *env, jobject obj, jfloat v )
00593 {
00594         <span class="keywordflow">return</span> ( v &lt; 0 || v &gt; 100 ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o1">GaussianSigma</a> = v;
00595 }
00596 
00597 
00598 JNIEXPORT jfloat JNICALL
00599 Java_GridModel_getMotionBendFactor( JNIEnv *env, jobject obj )
00600 {
00601         <span class="keywordflow">return</span> g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o0">BendFactor</a>;
00602 }
00603 
00604 
00605 JNIEXPORT jfloat JNICALL
00606 Java_GridModel_setMotionBendFactor( JNIEnv *env, jobject obj, jfloat v )
00607 {
00608         <span class="keywordflow">return</span> ( v &lt; 0 || v &gt; 100 ) ? -v : g_settings.<a class="code" href="struct_rm_settings.html#o13">MotionModel</a>.<a class="code" href="struct_rm_settings_1_1_motion_model_struct.html#o0">BendFactor</a> = v;
00609 }
00610 
00611 
00612 JNIEXPORT <span class="keywordtype">void</span> JNICALL
00613 Java_GridModel_saveSettings( JNIEnv *env, jobject obj )
00614 {
00615         g_settings.<a class="code" href="struct_rm_settings.html#a5">write</a>();
00616 }
00617 
00618 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Apr 3 16:46:53 2005 for Robot Mapper by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
