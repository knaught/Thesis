<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Robot Mapper: src/RmPolygon.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000001.html">src</a></div>
<h1>RmPolygon.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#pragma warning( disable : 4786 )</span>
00002 <span class="preprocessor"></span>
00003 <span class="preprocessor">#include "RmPolygon.h"</span>
00004 <span class="keyword">using</span> <a class="code" href="class_rm_utility_1_1_coord.html">RmUtility::Coord</a>;
00005 
00006 RmPolygon::RmPolygon( <span class="keyword">const</span> <a class="code" href="struct_rm_utility_1_1_bound_box.html">RmUtility::BoundBox</a> &amp;bound )
00007 {
00008         <span class="comment">// Modeled after </span>
00009         <span class="comment">// void gpc::gpc_read_polygon(FILE *fp, int read_hole_flags, gpc_polygon *p)</span>
00010 
00011         gpc_polygon *p = &amp;m_polygon;
00012         p-&gt;num_contours = 1;
00013         p-&gt;hole = <span class="keyword">new</span> <span class="keywordtype">int</span>[p-&gt;num_contours];
00014         p-&gt;contour = <span class="keyword">new</span> gpc_vertex_list[p-&gt;num_contours];
00015         <span class="keyword">const</span> <span class="keywordtype">int</span> c = 0;
00016     p-&gt;contour[c].num_vertices = 4;
00017         p-&gt;hole[c] = 0;
00018 
00019         p-&gt;contour[c].vertex = <span class="keyword">new</span> gpc_vertex[p-&gt;contour[c].num_vertices];
00020         p-&gt;contour[c].vertex[0].x = bound.<a class="code" href="struct_rm_utility_1_1_bound_box.html#o1">ul</a>.<a class="code" href="class_rm_utility_1_1_coord.html#o0">x</a>;
00021         p-&gt;contour[c].vertex[0].<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a> = bound.<a class="code" href="struct_rm_utility_1_1_bound_box.html#o1">ul</a>.<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a>;
00022         p-&gt;contour[c].vertex[1].<a class="code" href="class_rm_utility_1_1_coord.html#o0">x</a> = bound.<a class="code" href="struct_rm_utility_1_1_bound_box.html#o0">lr</a>.<a class="code" href="class_rm_utility_1_1_coord.html#o0">x</a>;
00023         p-&gt;contour[c].vertex[1].<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a> = bound.<a class="code" href="struct_rm_utility_1_1_bound_box.html#o1">ul</a>.<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a>;
00024         p-&gt;contour[c].vertex[2].<a class="code" href="class_rm_utility_1_1_coord.html#o0">x</a> = bound.<a class="code" href="struct_rm_utility_1_1_bound_box.html#o0">lr</a>.<a class="code" href="class_rm_utility_1_1_coord.html#o0">x</a>;
00025         p-&gt;contour[c].vertex[2].<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a> = bound.<a class="code" href="struct_rm_utility_1_1_bound_box.html#o0">lr</a>.<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a>;
00026         p-&gt;contour[c].vertex[3].<a class="code" href="class_rm_utility_1_1_coord.html#o0">x</a> = bound.<a class="code" href="struct_rm_utility_1_1_bound_box.html#o1">ul</a>.<a class="code" href="class_rm_utility_1_1_coord.html#o0">x</a>;
00027         p-&gt;contour[c].vertex[3].<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a> = bound.<a class="code" href="struct_rm_utility_1_1_bound_box.html#o0">lr</a>.<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a>;
00028 
00029         <span class="comment">// Have native polygon code validate this bound</span>
00030         <span class="comment">// If invalid, will have num_contours of 0</span>
00031         intersectWith( *<span class="keyword">this</span> );
00032 }
00033 
00034 
00035 RmPolygon::RmPolygon( <span class="keyword">const</span> gpc_polygon &amp;polygon )
00036 {
00037         createFrom( polygon );
00038 }
00039 
00040 
00041 RmPolygon::RmPolygon( <span class="keyword">const</span> RmPolygon &amp;polygon )
00042 {
00043         createFrom( polygon.m_polygon );
00044 }
00045 
00046 
00047 RmPolygon::~RmPolygon()
00048 {
00049         free();
00050 }
00051 
00052 
00053 RmPolygon&amp; RmPolygon::operator=( <span class="keyword">const</span> RmPolygon &amp;polygon )
00054 {
00055         free();
00056         createFrom( polygon.m_polygon );
00057         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00058 }
00059 
00060 
00061 <span class="keywordtype">void</span> RmPolygon::createFrom( <span class="keyword">const</span> gpc_polygon &amp;polygon )
00062 {
00063         <span class="comment">// Modeled after </span>
00064         <span class="comment">// void gpc::gpc_read_polygon(FILE *fp, int read_hole_flags, gpc_polygon *p)</span>
00065 
00066         gpc_polygon *p = &amp;m_polygon;
00067         p-&gt;num_contours = polygon.num_contours;
00068         p-&gt;hole = <span class="keyword">new</span> <span class="keywordtype">int</span>[p-&gt;num_contours];
00069         p-&gt;contour = <span class="keyword">new</span> gpc_vertex_list[p-&gt;num_contours];
00070         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; p-&gt;num_contours; ++c ) {
00071                 p-&gt;hole[c] = polygon.hole[c];
00072                 p-&gt;contour[c].num_vertices = polygon.contour[c].num_vertices;
00073                 p-&gt;contour[c].vertex = <span class="keyword">new</span> gpc_vertex[p-&gt;contour[c].num_vertices];
00074                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> v = 0; v &lt; p-&gt;contour[c].num_vertices; ++v ) {
00075                         p-&gt;contour[c].vertex[v] = polygon.contour[c].vertex[v];
00076                 }
00077         }
00078 }
00079 
00080 
00081 <span class="keywordtype">void</span> RmPolygon::free()
00082 {
00083         <span class="comment">// Modeled after </span>
00084         <span class="comment">// void gpc::gpc_free_polygon(gpc_polygon *p)</span>
00085 
00086         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; m_polygon.num_contours; ++c ) {
00087                 <span class="keyword">delete</span> [] m_polygon.contour[c].vertex;
00088         }
00089         <span class="keyword">delete</span> [] m_polygon.contour;
00090         <span class="keyword">delete</span> [] m_polygon.hole;
00091 }
00092 
00093 
00094 RmPolygon&amp; RmPolygon::intersectWith( <span class="keyword">const</span> RmPolygon &amp;polygon )
00095 {
00096         RmPolygon clip( polygon );
00097         gpc_polygon_clip( GPC_INT, &amp;m_polygon, &amp;clip.m_polygon, &amp;m_polygon );
00098         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00099 }
00100 
00101 
00102 RmPolygon RmPolygon::intersectedWith( <span class="keyword">const</span> RmPolygon &amp;clip )<span class="keyword"> const</span>
00103 <span class="keyword"></span>{
00104         RmPolygon subj( *<span class="keyword">this</span> );
00105         <span class="keywordflow">return</span> subj.intersectWith( clip );
00106 }
00107 
00108 
00109 RmPolygon&amp; RmPolygon::subtractOut( <span class="keyword">const</span> RmPolygon &amp;polygon )
00110 {
00111         RmPolygon clip( polygon );
00112         gpc_polygon_clip( GPC_DIFF, &amp;m_polygon, &amp;clip.m_polygon, &amp;m_polygon );
00113         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00114 }
00115 
00116 
00117 RmPolygon RmPolygon::subtractedOut( <span class="keyword">const</span> RmPolygon &amp;clip )<span class="keyword"> const</span>
00118 <span class="keyword"></span>{
00119         RmPolygon subj( *<span class="keyword">this</span> );
00120         <span class="keywordflow">return</span> subj.subtractOut( clip );
00121 }
00122 
00123 
00124 RmPolygon&amp; RmPolygon::unionWith( <span class="keyword">const</span> RmPolygon &amp;polygon )
00125 {
00126         RmPolygon clip( polygon );
00127         gpc_polygon_clip( GPC_UNION, &amp;m_polygon, &amp;clip.m_polygon, &amp;m_polygon );
00128         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00129 }
00130 
00131 
00132 RmPolygon RmPolygon::unionedWith( <span class="keyword">const</span> RmPolygon &amp;clip )<span class="keyword"> const</span>
00133 <span class="keyword"></span>{
00134         RmPolygon subj( *<span class="keyword">this</span> );
00135         <span class="keywordflow">return</span> subj.unionWith( clip );
00136 }
00137 
00138 
00139 std::ostream&amp; RmPolygon::put( std::ostream &amp;os )<span class="keyword"> const</span>
00140 <span class="keyword"></span>{
00141         os &lt;&lt; m_polygon.num_contours &lt;&lt; <span class="stringliteral">"\n"</span>;
00142         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; m_polygon.num_contours; ++c ) {
00143                 os &lt;&lt; m_polygon.contour[c].num_vertices &lt;&lt; <span class="stringliteral">"\n"</span>;
00144                 os &lt;&lt; m_polygon.hole[c] &lt;&lt; <span class="stringliteral">"\n"</span>;
00145                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> v = 0; v &lt; m_polygon.contour[c].num_vertices; ++v ) {
00146                         os &lt;&lt; <span class="stringliteral">"  "</span> &lt;&lt; m_polygon.contour[c].vertex[v].<a class="code" href="class_rm_utility_1_1_coord.html#o0">x</a> &lt;&lt; <span class="stringliteral">" "</span> 
00147                                 &lt;&lt; m_polygon.contour[c].vertex[v].<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a> &lt;&lt; <span class="stringliteral">"\n"</span>;
00148                 }
00149         }
00150 
00151         <span class="keywordflow">return</span> os;
00152 }
00153 
00154 
00155 std::ostream&amp; operator&lt;&lt;( std::ostream &amp;os, <span class="keyword">const</span> RmPolygon &amp;p )
00156 {
00157         <span class="keywordflow">return</span> p.put( os );
00158 }
00159 
00160 
00161 <span class="keywordtype">void</span> RmPolygon::fillInto( std::vector&lt;Coord&gt; *fv )<span class="keyword"> const</span>
00162 <span class="keyword"></span>{
00163         <span class="comment">// For each contour polygon</span>
00164         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; m_polygon.num_contours; ++c )
00165         {
00166                 <span class="comment">// Skip holes</span>
00167                 <span class="keywordflow">if</span> ( m_polygon.hole[c] ) <span class="keywordflow">continue</span>; 
00168 
00169                 <span class="comment">// Convert points for use by polyfill routine</span>
00170                 <span class="keyword">struct </span>Point *points = <span class="keyword">new</span> Point[m_polygon.contour[c].num_vertices];
00171                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> v = 0; v &lt; m_polygon.contour[c].num_vertices; ++v ) {
00172                         points[v].X = static_cast&lt;int&gt;(m_polygon.contour[c].vertex[v].x);
00173                         points[v].Y = static_cast&lt;int&gt;(m_polygon.contour[c].vertex[v].y);
00174                 }
00175 
00176                 PointListHeader pointListHeader = { m_polygon.contour[c].num_vertices, points };
00177 
00178                 <span class="comment">// Fill contour</span>
00179                 PointList *fill = FillPolygon( 
00180                         &amp;pointListHeader, 0 <span class="comment">/*color*/</span>, NONCONVEX, 0 <span class="comment">/*x-offset*/</span>, 0 <span class="comment">/*y-offset*/</span> );
00181 
00182                 <span class="comment">// Push into vector</span>
00183                 <span class="keywordflow">while</span> ( fill ) {
00184                         fv-&gt;push_back( <a class="code" href="class_rm_utility_1_1_coord.html">Coord</a>( fill-&gt;point.X, fill-&gt;point.Y ) );
00185                         fill = fill-&gt;next;
00186                 }
00187         }
00188 }
00189 
00190 
00191 std::vector&lt;Coord&gt; RmPolygon::fill()<span class="keyword"> const</span>
00192 <span class="keyword"></span>{
00193         std::vector&lt;Coord&gt; fill;
00194         fillInto( &amp;fill );
00195         <span class="keywordflow">return</span> fill;
00196 }
00197 
00198 
00199 std::vector&lt;Coord&gt; RmPolygon::line( <span class="keyword">const</span> <a class="code" href="class_rm_utility_1_1_coord.html">Coord</a> &amp;from, <span class="keyword">const</span> <a class="code" href="class_rm_utility_1_1_coord.html">Coord</a> &amp;to )
00200 {
00201         std::vector&lt;Coord&gt; line;
00202         PointList* linePointList = FillLine( from.<a class="code" href="class_rm_utility_1_1_coord.html#o0">x</a>, from.<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a>, to.<a class="code" href="class_rm_utility_1_1_coord.html#o0">x</a>, to.<a class="code" href="class_rm_utility_1_1_coord.html#o1">y</a> );  <span class="comment">// [start..end)</span>
00203         <span class="keywordflow">while</span> ( linePointList ) 
00204         {
00205                 line.push_back( <a class="code" href="class_rm_utility_1_1_coord.html">Coord</a>( linePointList-&gt;point.X, linePointList-&gt;point.Y ) );
00206                 linePointList = linePointList-&gt;next;
00207         }
00208 
00209         <span class="keywordflow">return</span> line;
00210 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Apr 3 16:46:53 2005 for Robot Mapper by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
