<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Robot Mapper: src/RmClient.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000001.html">src</a></div>
<h1>RmClient.cpp</h1><div class="fragment"><pre class="fragment">00001 
00002 <span class="preprocessor">#include &lt;iostream&gt;</span>
00003 <span class="preprocessor">#include "RmClient.h"</span>
00004 <span class="preprocessor">#include "RmExceptions.h"</span>
00005 
00006 
<a name="l00007"></a><a class="code" href="class_rm_client.html#a1">00007</a> <a class="code" href="class_rm_client.html#a1">RmClient::RmClient</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *serverName, <span class="keyword">const</span> <span class="keywordtype">short</span> portNumber )
00008 {
00009         WORD wVersionRequested = MAKEWORD(1,1);
00010         WSADATA wsaData;
00011     <span class="keywordtype">int</span> nRet = WSAStartup(wVersionRequested, &amp;wsaData);
00012         <span class="keywordflow">if</span> (wsaData.wVersion != wVersionRequested)
00013         {       
00014                 <span class="keywordflow">throw</span> <a class="code" href="struct_rm_exceptions_1_1_socket_exception.html">RmExceptions::SocketException</a>( <span class="stringliteral">"RmServer::RmServer()"</span>, <span class="stringliteral">"Wrong version"</span> );
00015         }
00016         
00017         <a class="code" href="class_rm_client.html#b0">initClient</a>( serverName, portNumber );
00018 }
00019 
00020 
<a name="l00021"></a><a class="code" href="class_rm_client.html#a3">00021</a> <a class="code" href="class_rm_client.html#a3">RmClient::~RmClient</a>()
00022 {
00023         closesocket( m_socket );
00024 
00025         WSACleanup(); <span class="comment">// release WinSock</span>
00026 }
00027 
00028 
<a name="l00029"></a><a class="code" href="class_rm_client.html#b0">00029</a> <span class="keywordtype">void</span> <a class="code" href="class_rm_client.html#b0">RmClient::initClient</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *serverName, <span class="keyword">const</span> <span class="keywordtype">short</span> portNumber )
00030 {
00031         <span class="comment">//</span>
00032         <span class="comment">// Find the server</span>
00033         <span class="comment">//</span>
00034     LPHOSTENT lpHostEntry;
00035         
00036         lpHostEntry = gethostbyname( serverName );
00037     <span class="keywordflow">if</span> (lpHostEntry == NULL)
00038     {
00039                 closesocket( m_socket );
00040                 <span class="keywordflow">throw</span> <a class="code" href="struct_rm_exceptions_1_1_socket_exception.html">RmExceptions::SocketException</a>( <span class="stringliteral">"RmServer::initClient()"</span>, <span class="stringliteral">"Unable to get host name"</span> );
00041     }
00042         
00043         
00044         <span class="comment">//</span>
00045         <span class="comment">// Create a UDP/IP datagram socket</span>
00046         <span class="comment">//</span>
00047         m_socket = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP );
00048         <span class="keywordflow">if</span> (m_socket == INVALID_SOCKET)
00049         {
00050                 closesocket(m_socket);
00051                 <span class="keywordflow">throw</span> <a class="code" href="struct_rm_exceptions_1_1_socket_exception.html">RmExceptions::SocketException</a>( <span class="stringliteral">"RmServer::initClient()"</span>, <span class="stringliteral">"Unable to create socket"</span> );
00052         }
00053         
00054         <span class="comment">//</span>
00055         <span class="comment">// Fill in the address structure for the server</span>
00056         <span class="comment">//</span>
00057         m_serverAddress.sin_family = AF_INET;
00058         m_serverAddress.sin_addr = *((LPIN_ADDR)*lpHostEntry-&gt;h_addr_list);
00059         m_serverAddress.sin_port = htons( portNumber );
00060 }
00061 
00062 
<a name="l00063"></a><a class="code" href="class_rm_client.html#a0">00063</a> std::string <a class="code" href="class_rm_client.html#a0">RmClient::getReply</a>()
00064 {
00065         <span class="keywordtype">int</span> nFromLen = <span class="keyword">sizeof</span>(SOCKADDR);
00066         memset( m_szBuf, 0, <span class="keyword">sizeof</span>(m_szBuf) );
00067         <span class="keywordtype">int</span> nRet = recvfrom( m_socket, m_szBuf, <span class="keyword">sizeof</span>(m_szBuf), 0, (LPSOCKADDR)&amp;m_serverAddress, 
00068                 &amp;nFromLen );
00069 
00070         <span class="keywordflow">if</span> ( nRet == SOCKET_ERROR ) {
00071                 std::cerr &lt;&lt; <span class="stringliteral">"RmClient::getReply() : Socket error\n"</span>;
00072         }
00073 
00074         <span class="keywordflow">return</span> std::string( m_szBuf );
00075 }
00076 
00077 
<a name="l00078"></a><a class="code" href="class_rm_client.html#a2">00078</a> <span class="keywordtype">void</span> <a class="code" href="class_rm_client.html#a2">RmClient::sendServerString</a>( std::string s )
00079 {
00080         <span class="keywordtype">int</span> nRet = sendto( m_socket, s.c_str(), s.length(), 0, (LPSOCKADDR)&amp;m_serverAddress, 
00081                 <span class="keyword">sizeof</span>(SOCKADDR) );
00082         <span class="keywordflow">if</span> ( nRet == SOCKET_ERROR ) {
00083                 std::cerr &lt;&lt; <span class="stringliteral">"RmClient::sendServerString() : Socket error\n"</span>;
00084         }
00085 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Apr 3 16:46:53 2005 for Robot Mapper by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
