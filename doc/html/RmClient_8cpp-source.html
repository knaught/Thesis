<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Robot Mapper: src/RmClient.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">src</a></div>
<h1>RmClient.cpp</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">// RmClient.cpp</span>
00002 
00003 <span class="preprocessor">#include &lt;iostream&gt;</span>
00004 <span class="preprocessor">#include "RmClient.h"</span>
00005 <span class="preprocessor">#include "RmExceptions.h"</span>
00006 
00007 
<a name="l00008"></a><a class="code" href="classRmClient.html#a1">00008</a> <a class="code" href="classRmClient.html#a1">RmClient::RmClient</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *serverName, <span class="keyword">const</span> <span class="keywordtype">short</span> portNumber )
00009 {
00010         WORD wVersionRequested = MAKEWORD(1,1);
00011         WSADATA wsaData;
00012     <span class="keywordtype">int</span> nRet = WSAStartup(wVersionRequested, &amp;wsaData);
00013         <span class="keywordflow">if</span> (wsaData.wVersion != wVersionRequested)
00014         {       
00015                 <span class="keywordflow">throw</span> <a class="code" href="structRmExceptions_1_1SocketException.html">RmExceptions::SocketException</a>( <span class="stringliteral">"RmServer::RmServer()"</span>, <span class="stringliteral">"Wrong version"</span> );
00016         }
00017         
00018         <a class="code" href="classRmClient.html#b0">initClient</a>( serverName, portNumber );
00019 }
00020 
00021 
<a name="l00022"></a><a class="code" href="classRmClient.html#a3">00022</a> <a class="code" href="classRmClient.html#a3">RmClient::~RmClient</a>()
00023 {
00024         closesocket( m_socket );
00025 
00026         WSACleanup(); <span class="comment">// release WinSock</span>
00027 }
00028 
00029 
<a name="l00030"></a><a class="code" href="classRmClient.html#b0">00030</a> <span class="keywordtype">void</span> <a class="code" href="classRmClient.html#b0">RmClient::initClient</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *serverName, <span class="keyword">const</span> <span class="keywordtype">short</span> portNumber )
00031 {
00032         <span class="comment">//</span>
00033         <span class="comment">// Find the server</span>
00034         <span class="comment">//</span>
00035     LPHOSTENT lpHostEntry;
00036         
00037         lpHostEntry = gethostbyname( serverName );
00038     <span class="keywordflow">if</span> ( lpHostEntry == NULL )
00039     {
00040                 closesocket( m_socket );
00041                 <span class="keywordflow">throw</span> <a class="code" href="structRmExceptions_1_1SocketException.html">RmExceptions::SocketException</a>( <span class="stringliteral">"RmServer::initClient()"</span>, <span class="stringliteral">"Unable to get host name"</span> );
00042     }
00043         
00044         
00045         <span class="comment">//</span>
00046         <span class="comment">// Create a UDP/IP datagram socket</span>
00047         <span class="comment">//</span>
00048         m_socket = socket( AF_INET, SOCK_DGRAM, IPPROTO_UDP );
00049         <span class="keywordflow">if</span> ( m_socket == INVALID_SOCKET )
00050         {
00051                 closesocket(m_socket);
00052                 <span class="keywordflow">throw</span> <a class="code" href="structRmExceptions_1_1SocketException.html">RmExceptions::SocketException</a>( <span class="stringliteral">"RmServer::initClient()"</span>, <span class="stringliteral">"Unable to create socket"</span> );
00053         }
00054         
00055         <span class="comment">//</span>
00056         <span class="comment">// Fill in the address structure for the server</span>
00057         <span class="comment">//</span>
00058         m_serverAddress.sin_family = AF_INET;
00059         m_serverAddress.sin_addr = *((LPIN_ADDR)*lpHostEntry-&gt;h_addr_list);
00060         m_serverAddress.sin_port = htons( portNumber );
00061 }
00062 
00063 
<a name="l00064"></a><a class="code" href="classRmClient.html#a0">00064</a> std::string <a class="code" href="classRmClient.html#a0">RmClient::getServerReply</a>()
00065 {
00066         <span class="keywordtype">int</span> nFromLen = <span class="keyword">sizeof</span>(SOCKADDR);
00067         memset( m_szBuf, 0, <span class="keyword">sizeof</span>(m_szBuf) );
00068         <span class="keywordtype">int</span> nRet = recvfrom( m_socket, m_szBuf, <span class="keyword">sizeof</span>(m_szBuf), 0, (LPSOCKADDR)&amp;m_serverAddress, 
00069                 &amp;nFromLen );
00070 
00071         <span class="keywordflow">if</span> ( nRet == SOCKET_ERROR ) {
00072                 <span class="keywordflow">throw</span> <a class="code" href="structRmExceptions_1_1SocketException.html">RmExceptions::SocketException</a>( <span class="stringliteral">"RmClient::getReply()"</span>, <span class="stringliteral">"Socket error"</span> );
00073         }
00074 
00075         <span class="keywordflow">return</span> std::string( m_szBuf );
00076 }
00077 
00078 
<a name="l00079"></a><a class="code" href="classRmClient.html#a2">00079</a> <span class="keywordtype">void</span> <a class="code" href="classRmClient.html#a2">RmClient::sendServerString</a>( std::string s )
00080 {
00081         <span class="keywordtype">int</span> nRet = sendto( m_socket, s.c_str(), s.length(), 0, (LPSOCKADDR)&amp;m_serverAddress, 
00082                 <span class="keyword">sizeof</span>(SOCKADDR) );
00083         <span class="keywordflow">if</span> ( nRet == SOCKET_ERROR ) {
00084                 <span class="keywordflow">throw</span> <a class="code" href="structRmExceptions_1_1SocketException.html">RmExceptions::SocketException</a>( <span class="stringliteral">"RmClient::sendServerString()"</span>, <span class="stringliteral">"Socket error"</span> );
00085         }
00086 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun May 1 23:40:03 2005 for Robot Mapper by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
