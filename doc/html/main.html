<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Robot Mapper: Main Page</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindexHL" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>Robot Mapper Documentation</h1>
<p>
The Robot Mapper classes provide a general framework for mapping an environment using a robot, specifically an environment mapped over a probabilistic occupancy grid using a sonar-based Pioneer 2-AT robot. It supports command line and library execution; off-line (recorded) and on-line (live) map construction and viewing; on-board and wireless operation; as well simulated and real-world environments. Robot Mapper also serves as the engine (in its DLL form) to the Java-based Map Viewer application, which is documented separately.<h2><a class="anchor" name="org">
Organization</a></h2>
The classes, structures and namespaces that compose the Robot Mapper suite fall into three broad categories, listed and diagrammed below. The diagram also shows inheritance relationships, with arrows pointing to superclasses.<p>
<ul>
<li>
<b>Utility</b>: <a class="el" href="namespaceRmUtility.html">RmUtility</a>, <a class="el" href="namespaceRmExceptions.html">RmExceptions</a>, <a class="el" href="classRmMutableMatrix.html">RmMutableMatrix</a>, <a class="el" href="classRmMutableCartesianGrid.html">RmMutableCartesianGrid</a> </li>
<li>
<b>Robot Interface</b>: <a class="el" href="classRmPioneerController.html">RmPioneerController</a>, <a class="el" href="classRmActionHook.html">RmActionHook</a>, <a class="el" href="classRmActionHandler.html">RmActionHandler</a>, <a class="el" href="classRmSonarMapper.html">RmSonarMapper</a> </li>
<li>
<b>Mapping</b>: <a class="el" href="classRmSonarMap.html">RmSonarMap</a>, <a class="el" href="classRmBayesCertaintyGrid.html">RmBayesCertaintyGrid</a>, <a class="el" href="classRmGlobalMap.html">RmGlobalMap</a>, <a class="el" href="classRmLocalMap.html">RmLocalMap</a>, <a class="el" href="classRmBayesSonarModel.html">RmBayesSonarModel</a> </li>
</ul>
<p>
<center><div align="center">
<img src="..\classDiagram.jpg" alt="classDiagram.jpg">
</div>
</center><p>
With the exception of <a class="el" href="structRmUtility_1_1SonarReading.html">RmUtility::SonarReading</a> (which depends on the ArRobot and ArPose classes documented in the Aria API), the utility classes are independent of any specific application. The Robot Interface classes are specific to the ActivMedia Aria API and Pioneer 2-AT, which provide a single-step robot initialization and sonar collection and recording mechanism. The Mapping classes provide the Bayesian occupancy grid sonar mapping and localization functionality.<p>
There are three source files included within RmMapper that have functions and definitions outside the scope of a class, structure, or namespace, and thus aren't included in this documentation. These are src/main.cpp (the main application), src/client.cpp (the wireless client application), and src/RmJavaGridModel.cpp (the Java native interface bridge between RmMapper and the separate graphical Java map viewer). The source code for all of these is available via the File List link at the top of the page.<h2><a class="anchor" name="start">
Program Flow</a></h2>
While the previous section briefly describes the hierarchical class structure, this section focuses on program flow over five different modes of operation.<p>
The modes have to do with whether sonar data processed is live or static, and for live data, whether the robot or simulator is operated locally or remotely. Additionally, the map viewer may build maps using static or live data, both remotely or locally.<p>
<ol>
<li>
Live local: a map is built using live data from the robot or simulator via onboard or directly connected mapping software </li>
<li>
Static local: a map is built using pre-recorded static sonar data </li>
<li>
Live remote: a map is built using live data from the robot or simulator over a wireless UDP connection </li>
<li>
Static local viewer: a map is simultaneously built and viewed using pre-recorded static sonar data </li>
<li>
Live remote viewer: a map is simultaneously built and viewed using live data from the robot or simulator over a wireless UDP connection </li>
</ol>
<p>
The below diagram illustrates these and several other relationships, to include operational, functional, controlling process, inheritance, and process flow.<p>
The first three operational modes are represented in the below by the three controlling process circles labeled "Mapper Live", "Mapper Static", and "Mapper Remote". All three of these are elements of src/main.cpp. The remaining two modes, which overlay the map viewer functionality, are identified by the display symbols labeled "Viewer Static" and "Viewer Remote Client". These are elements of viewer/src/MapViewer.java.<p>
There are also six distinct functional regions shown in the diagram. The large yellow area encompasses all the software within RmMapper that is responsible for acquiring data and building a map. Within that region, the live local flow is shaded in burgandy; the static local flow is shaded in blue; the live remote flow and live remote viewer flow are shaded in red; and the static local viewer flow is shaded in green. Finally, those elements that fall outside the yellow region altogether are those that are external to the RmMapper application.<p>
<center><div align="center">
<img src="..\flowDiagram.jpg" alt="flowDiagram.jpg">
</div>
</center><p>
Controlling processes, as mentioned, are shown as circles. Those circles drawn as an arrow contain a main control loop; those that are shaded are console applications. Mapper Live, which doesn't utilize a control loop, creates an <a class="el" href="classRmPioneerController.html">RmPioneerController</a> object that itself performs all the mapping functionality, while src/main.cpp blocks until that object completes its task and is destroyed (see mapFromRobot() in src/main.cpp). Those processes that overlap an object indicate those processes <em>are</em> that object. For example, the Robot Sim process, which represents the robot or simulator, is actually encapsulated within, and therefore is, an <a class="el" href="classRmPioneerController.html">RmPioneerController</a> object.<p>
Objects are further illustrated with nesting, which indicates inheritance relationships. For example, an <a class="el" href="classRmGlobalMap.html">RmGlobalMap</a> <em>is</em> an <a class="el" href="classRmBayesCertaintyGrid.html">RmBayesCertaintyGrid</a>, which <em>is</em>, in turn, an <a class="el" href="classRmMutableCartesianGrid.html">RmMutableCartesianGrid</a>, etc. The unique relationship between an <a class="el" href="classRmGlobalMap.html">RmGlobalMap</a> and <a class="el" href="classRmLocalMap.html">RmLocalMap</a> is shown through adjacency and multiplicity: an <a class="el" href="classRmGlobalMap.html">RmGlobalMap</a> is composed of multiple <a class="el" href="classRmLocalMap.html">RmLocalMap</a> objects.<p>
Process flow is shown using arrows. The starting end of the arrow identifies the calling object; the terminating end, the object being called. If a method is identified on the line, it is that of the called object. For example, <a class="el" href="classRmSonarMapper.html">RmSonarMapper</a>, in the middle of the diagram, calls <a class="el" href="classRmServer.html#a2">RmServer::sendClientReply()</a>. Methods that utilize a return value are shown with a diamond on the calling object, and the return value follows the method name, with a colon separating them. For example, RmJavaGridModel, in the green region, calls <a class="el" href="classRmSonarMapper.html#a1">RmSonarMapper::mapReading()</a> and expects a map string in response. This is then passed back to Viewer Static as its return value for stepSonarMapper(). Dashed arrows indicate wireless communication.<p>
As an example that ties all this together, consider the live remote viewer mode, where the robot is controlled wirelessly and the map is built in real-time, also on a wireless console. Three applications are executed in this case: the server on the robot, Mapper Remote (bin/Mapper.exe); and two on the client, bin/MapperClient.exe and viewer/bin/MapViewer.class. Once handshakes have been exchanged between the server and the two clients, the user controls the robot via the console shown in the lower right hand side of the diagram. These key controls are acquired by Client, and communicated wirelessly via <a class="el" href="classRmClient.html">RmClient</a> to the Control <a class="el" href="classRmServer.html">RmServer</a> on Mapper Remote, which then translates the control into a motion command and forwards it on to the robot (or simulator), Robot Sim (an <a class="el" href="classRmPioneerController.html">RmPioneerController</a>), using the Aria object ArActionKeydrive. While the robot is physically responding to the command, the Pioneer is sending sonar data to <a class="el" href="classRmSonarMapper.html">RmSonarMapper</a> via the Aria API's call to fire() <a class="el" href="classRmSonarMapper.html#a0">RmSonarMapper::handleAction()</a>. <a class="el" href="classRmSonarMapper.html">RmSonarMapper</a> saves the sonar data to a *.sd file, and asks <a class="el" href="classRmGlobalMap.html">RmGlobalMap</a> to update the map using that data. <a class="el" href="classRmGlobalMap.html">RmGlobalMap</a> returns the map update string, which <a class="el" href="classRmSonarMapper.html">RmSonarMapper</a> gives to the Viewer <a class="el" href="classRmServer.html">RmServer</a> within Mapper Remote. Mapper Remote then sends the string wirelessly back to Viewer Remote Client. Finally, the viewer processes the map string and updates the map display accordingly.<h2><a class="anchor" name="build">
Builds and Dependencies</a></h2>
This section contains build-specific information that is independent of the classes and other structures that compose the RmMapper application, but is provided as a description of the environment and configuration used for compilation and build.<h3><a class="anchor" name="paths">
Paths</a></h3>
The following paths should be included in the PATH environment variable (set via System Properties - Advanced - Environment Variables): <ul>
<li>
C:\Program Files\Java\jdk1.5.0\bin </li>
<li>
C:\Program Files\ActivMedia Robotics\Aria-2.1-1\bin </li>
<li>
..\Mapper\bin </li>
</ul>
<h3><a class="anchor" name="projects">
Projects</a></h3>
The RmMapper workspace is divided up into five projects. Two of these correspond to the client and server control applications, and three are the libraries that provide the mapping functionality:<p>
<table border="0" cellpadding="0" cellspacing="5">
<tr>
<td><b>Project</b> </td><td><b>Build</b> </td><td><b>Description</b>  </td></tr>
<tr valign="top">
<td>MapperCon </td><td>../bin/Mapper.exe </td><td>Main console/server application for mapping pre-recorded or live sonar data  </td></tr>
<tr valign="top">
<td>MapperClient </td><td>../bin/MapperClient.exe </td><td>Client application for controlling robot drive wirelessly using UDP/IP  </td></tr>
<tr valign="top">
<td>MapperLib </td><td>../lib/Mapper.lib </td><td>Static library of all mapping functionality  </td></tr>
<tr valign="top">
<td>MapperDll </td><td>../bin/Mapper.dll </td><td>Dynamic library of all mapping functionality with Java map viewer interface  </td></tr>
<tr valign="top">
<td>Polygon </td><td>../lib/Polygon.lib </td><td>Third party code for line and polygon functions  </td></tr>
</table>
<h3><a class="anchor" name="config">
IDE Configuration</a></h3>
The application is compiled using Microsoft Visual C++ 6.0 (build attempts with .NET were unsuccessful), linked with Aria 2.1.1, and integrated with the graphical map viewer written using Java 1.5.0.<p>
Visual C++ configuration is given by the following:<p>
Dependencies are established for each project that isn't a static library in the Object/library modules field in the Link tab of Project Properties. Shown in the image are those dependencies specific to the main application, MapperCon. MapperClient is not dependent upon Aria.lib or ../lib/Polygon.lib. MapperDll is not dependent upon ../lib/Mapper.lib.<p>
<center><div align="center">
<img src="..\projectSettingsLink.jpg" alt="projectSettingsLink.jpg">
</div>
</center><p>
Visual C++ is also configured to look in specific directories for any include or library files, as shown:<p>
<center> <div align="center">
<img src="..\libraryDirectories.jpg" alt="libraryDirectories.jpg">
</div>
<br>
 <div align="center">
<img src="..\includeDirectories.jpg" alt="includeDirectories.jpg">
</div>
 </center><h2><a class="anchor" name="usage">
Usage</a></h2>
While the commands issued at the command line are dependent upon the build setups, this documentation assumes: <ul>
<li>
src/client.cpp is built as MapperClient.exe (Client) </li>
<li>
src/main.cpp is built as Mapper.exe (Server) </li>
<li>
src/viewer.bat is a batch file that executes the Java viewer application </li>
</ul>
<p>
There are three mapping modes supported by Mapper.exe: <ul>
<li>
Pre-recorded: ..\bin&gt; Mapper -si &lt;filename&gt; [-g &lt;gridFilename&gt;] </li>
<li>
Live local: ..\bin&gt; Mapper -so[o] &lt;filename&gt; [-g &lt;gridFilename&gt;] </li>
<li>
Live remote: This involves the simultaneous execution of a server (robot drive) and at least two client consoles (robot control and map viewer). For simulation, all three can be executed on the same machine; for real-world, the server must be executed on the robot, and the clients on a wirelessly connected computer. A sample execution sequence follows.<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr>
<td colspan="4"><hr>
<hr>
  <p>
</td></tr>
<tr valign="top">
<td></td><td><b>Server Console (Robot)</b> </td><td><b>Remote Control Client</b> </td><td><b>Remote Viewer Client</b> <p>
</td></tr>
<tr>
<td colspan="4"><hr>
  <p>
</td></tr>
<tr valign="top">
<td><small>1</small> </td><td colspan="2"><code> ..\bin&gt; <b>Mapper -so[o] &lt;filename&gt; -r &lt;portNumber&gt;</b><br>
 Remote control server '&lt;serverName&gt;' waiting on port &lt;portNumber&gt;<br>
 Map viewer server '&lt;serverName&gt;' waiting on port &lt;portNumber + 1&gt; </code>  </td><td><p>
</td></tr>
<tr>
<td colspan="4"><hr>
  <p>
</td></tr>
<tr valign="top">
<td><small>2</small> </td><td></td><td colspan="2"><code> ..\bin&gt; <b>MapperClient &lt;serverName&gt; &lt;portNumber&gt;</b><br>
 Remote Control Server says: Welcome<br>
 Please use the following keyboard controls:<br>
 On/off : 'o' and Home key<br>
 Forward, Backward, Left, Right : Arrow keys, Numkey arrow keys<br>
 Stop : Spacebary Numkey 5<br>
 Change data file : d<br>
 Quit : q<br>
 &gt; </code> <p>
</td></tr>
<tr valign="top">
<td></td><td><code>Remote client says: Hello</code>  </td><td></td><td><p>
</td></tr>
<tr>
<td colspan="4"><hr>
  <p>
</td></tr>
<tr valign="top">
<td><small>3</small> </td><td></td><td><code> &gt; <b>v</b><br>
 Mode: <b>cell</b> </code>  </td><td><p>
</td></tr>
<tr valign="top">
<td></td><td colspan="2"><code> vcell<br>
 Awaiting handshake from Remote Control Viewer </code>  </td><td><p>
</td></tr>
<tr>
<td colspan="4"><hr>
  <p>
</td></tr>
<tr valign="top">
<td><small>4</small> </td><td></td><td></td><td><code> ..\bin&gt; <b>viewer &lt;serverName&gt; &lt;portNumber&gt;</b><br>
 Sending greeting to host &lt;serverName&gt; on port &lt;portNumber + 1&gt;<br>
 Remote View Server says: Welcome </code>  <p>
</td></tr>
<tr valign="top">
<td></td><td><code>Remote Control Viewer says: Hello</code>  </td><td><code>Viewer sonar mode set to Single Cell<br>
 &gt;</code>  </td><td><p>
</td></tr>
<tr>
<td colspan="4"><hr>
  <p>
</td></tr>
<tr valign="top">
<td><small>5</small> </td><td colspan="3" align="center"><em><b>When remote viewer application comes up, press Play.<br>
 Ensure robot or simulator connection has been established.</b></em><br>
  <p>
</td></tr>
<tr>
<td colspan="4"><hr>
  <p>
</td></tr>
<tr valign="top">
<td><small>6</small> </td><td></td><td colspan="2"><code> &gt; <b>&lt;o&gt;</b>Sonar file '&lt;filename&gt;' successfully opened for write.<br>
 &gt; </code>  <p>
</td></tr>
<tr valign="top">
<td></td><td colspan="2"><code> on<br>
 Connecting to simulator through tcp.<br>
 Syncing 0<br>
 Syncing 1<br>
 Syncing 2<br>
 Connected to robot.<br>
 Name: simler<br>
 Type: Pioneer<br>
 Subtype: p2at8<br>
 Loaded robot parameters from p2at8.p<br>
 Keydrive </code>  </td><td><p>
</td></tr>
<tr>
<td colspan="4"><hr>
  <p>
</td></tr>
<tr valign="top">
<td><small>7</small> </td><td></td><td><code>&gt;</code> <small><b>&lt;up-arrow&gt;</b></small><code>forward</code>  </td><td><p>
</td></tr>
<tr valign="top">
<td></td><td><code>forward</code>  </td><td></td><td><p>
</td></tr>
<tr>
<td colspan="4"><hr>
  <p>
</td></tr>
<tr valign="top">
<td><small>8</small> </td><td></td><td><code>&gt;</code> <small><b>&lt;spacebar&gt;</b></small><code>stop</code>  </td><td><p>
</td></tr>
<tr valign="top">
<td></td><td><code>stop</code>  </td><td></td><td><p>
</td></tr>
<tr>
<td colspan="4"><hr>
  <p>
</td></tr>
<tr valign="top">
<td><small>9</small> </td><td></td><td><code>&gt; <b>o</b>ff</code>  </td><td><p>
</td></tr>
<tr valign="top">
<td></td><td><code>off<br>
 Disconnecting from robot.</code>  </td><td></td><td><p>
</td></tr>
<tr>
<td colspan="4"><hr>
  <p>
</td></tr>
<tr valign="top">
<td><small>10</small> </td><td></td><td><code>&gt; <b>q</b>uit</code>  </td><td><p>
</td></tr>
<tr valign="top">
<td></td><td><code> quit<br>
 Disconnecting from robot.<br>
 ..\bin&gt; </code>  </td><td><code>..\bin&gt;</code>  </td><td><code>..\bin&gt;</code>  <p>
</td></tr>
<tr>
<td colspan="4"><hr>
<hr>
  <p>
</td></tr>
</table>
</li>
</ul>
<h2><a class="anchor" name="info">
Further Information</a></h2>
Please contact Kevin Owens at <a href="mailto:kpo50@yahoo.com">kpo50@yahoo.com</a> with any questions or assistance in extending this application or its modules. <hr size="1"><address style="align: right;"><small>Generated on Sun May 1 23:40:03 2005 for Robot Mapper by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
